<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue3源码解析(V3.2.45)-渲染原理及diff算法 | 追光学院</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/day-logo.png">
    <meta name="description" content="技术博客,技术文档,知识库,元宇宙,区块链,大数据,数字孪生,game,xr,vr,mr,ar,JavaScript,Unity3d,3dsmax,maya,blender,ps,photoshop,u3d,Unity,js,ES6,TypeScript,vue,React,python,css3,html5,Node,C#,C++,git,github,markdown,gitee,游戏,面试等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,unity3d,u3d,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.482b2b4f.css" as="style"><link rel="preload" href="/assets/js/app.17c3de54.js" as="script"><link rel="preload" href="/assets/js/2.712e115f.js" as="script"><link rel="preload" href="/assets/js/214.706faf32.js" as="script"><link rel="prefetch" href="/assets/js/10.c3104c18.js"><link rel="prefetch" href="/assets/js/100.1f898a22.js"><link rel="prefetch" href="/assets/js/101.d2d8b339.js"><link rel="prefetch" href="/assets/js/102.0e5e7f25.js"><link rel="prefetch" href="/assets/js/103.c56a307d.js"><link rel="prefetch" href="/assets/js/104.5ea6cc35.js"><link rel="prefetch" href="/assets/js/105.a798f942.js"><link rel="prefetch" href="/assets/js/106.69422879.js"><link rel="prefetch" href="/assets/js/107.9cd9ab03.js"><link rel="prefetch" href="/assets/js/108.434cace6.js"><link rel="prefetch" href="/assets/js/109.54b48a3b.js"><link rel="prefetch" href="/assets/js/11.8626b198.js"><link rel="prefetch" href="/assets/js/110.7bb0d54d.js"><link rel="prefetch" href="/assets/js/111.3c353603.js"><link rel="prefetch" href="/assets/js/112.8034bd9a.js"><link rel="prefetch" href="/assets/js/113.1dc11c1d.js"><link rel="prefetch" href="/assets/js/114.52bf7491.js"><link rel="prefetch" href="/assets/js/115.f6e37b62.js"><link rel="prefetch" href="/assets/js/116.05c35cd8.js"><link rel="prefetch" href="/assets/js/117.ecb729c2.js"><link rel="prefetch" href="/assets/js/118.cbdd1d9e.js"><link rel="prefetch" href="/assets/js/119.c485d67c.js"><link rel="prefetch" href="/assets/js/12.28e9be5e.js"><link rel="prefetch" href="/assets/js/120.8e6e4688.js"><link rel="prefetch" href="/assets/js/121.ee845b39.js"><link rel="prefetch" href="/assets/js/122.e9ef0541.js"><link rel="prefetch" href="/assets/js/123.c55524b0.js"><link rel="prefetch" href="/assets/js/124.34448cdf.js"><link rel="prefetch" href="/assets/js/125.78751649.js"><link rel="prefetch" href="/assets/js/126.88925fbe.js"><link rel="prefetch" href="/assets/js/127.1f4965d9.js"><link rel="prefetch" href="/assets/js/128.ec2dafdd.js"><link rel="prefetch" href="/assets/js/129.863c4d9f.js"><link rel="prefetch" href="/assets/js/13.399a9f5c.js"><link rel="prefetch" href="/assets/js/130.ad2c98e0.js"><link rel="prefetch" href="/assets/js/131.c6be2246.js"><link rel="prefetch" href="/assets/js/132.74ba876a.js"><link rel="prefetch" href="/assets/js/133.ed8dc460.js"><link rel="prefetch" href="/assets/js/134.4112c835.js"><link rel="prefetch" href="/assets/js/135.0484b079.js"><link rel="prefetch" href="/assets/js/136.5e8ee7d7.js"><link rel="prefetch" href="/assets/js/137.b94d9248.js"><link rel="prefetch" href="/assets/js/138.9c4a3513.js"><link rel="prefetch" href="/assets/js/139.a4443a61.js"><link rel="prefetch" href="/assets/js/14.9aacc650.js"><link rel="prefetch" href="/assets/js/140.a10f511b.js"><link rel="prefetch" href="/assets/js/141.93990709.js"><link rel="prefetch" href="/assets/js/142.da1d5eee.js"><link rel="prefetch" href="/assets/js/143.b67eae1f.js"><link rel="prefetch" href="/assets/js/144.d5799827.js"><link rel="prefetch" href="/assets/js/145.b71ad336.js"><link rel="prefetch" href="/assets/js/146.0dc0f7eb.js"><link rel="prefetch" href="/assets/js/147.f78fdc76.js"><link rel="prefetch" href="/assets/js/148.693d1bf2.js"><link rel="prefetch" href="/assets/js/149.1daf5d0a.js"><link rel="prefetch" href="/assets/js/15.5987d5d6.js"><link rel="prefetch" href="/assets/js/150.44b8e009.js"><link rel="prefetch" href="/assets/js/151.c061c06e.js"><link rel="prefetch" href="/assets/js/152.9fa50aee.js"><link rel="prefetch" href="/assets/js/153.523ce786.js"><link rel="prefetch" href="/assets/js/154.c95a6cf0.js"><link rel="prefetch" href="/assets/js/155.9df71558.js"><link rel="prefetch" href="/assets/js/156.8d199088.js"><link rel="prefetch" href="/assets/js/157.797796bf.js"><link rel="prefetch" href="/assets/js/158.11e40098.js"><link rel="prefetch" href="/assets/js/159.9c75e8b2.js"><link rel="prefetch" href="/assets/js/16.7cfa37ef.js"><link rel="prefetch" href="/assets/js/160.bd95e754.js"><link rel="prefetch" href="/assets/js/161.573106e3.js"><link rel="prefetch" href="/assets/js/162.a953d2fa.js"><link rel="prefetch" href="/assets/js/163.90bdb418.js"><link rel="prefetch" href="/assets/js/164.6b64fa95.js"><link rel="prefetch" href="/assets/js/165.62b4103b.js"><link rel="prefetch" href="/assets/js/166.c33036ef.js"><link rel="prefetch" href="/assets/js/167.90ca260a.js"><link rel="prefetch" href="/assets/js/168.253ee638.js"><link rel="prefetch" href="/assets/js/169.9121d90c.js"><link rel="prefetch" href="/assets/js/17.e2c50d5c.js"><link rel="prefetch" href="/assets/js/170.a4b8bf9f.js"><link rel="prefetch" href="/assets/js/171.5db531c1.js"><link rel="prefetch" href="/assets/js/172.3b7f3831.js"><link rel="prefetch" href="/assets/js/173.c08303de.js"><link rel="prefetch" href="/assets/js/174.73537c45.js"><link rel="prefetch" href="/assets/js/175.e67171ae.js"><link rel="prefetch" href="/assets/js/176.ece88748.js"><link rel="prefetch" href="/assets/js/177.1023f42c.js"><link rel="prefetch" href="/assets/js/178.d43382a9.js"><link rel="prefetch" href="/assets/js/179.51f0b515.js"><link rel="prefetch" href="/assets/js/18.ba6256e6.js"><link rel="prefetch" href="/assets/js/180.fa612171.js"><link rel="prefetch" href="/assets/js/181.81a66b14.js"><link rel="prefetch" href="/assets/js/182.0612bf95.js"><link rel="prefetch" href="/assets/js/183.c4495b21.js"><link rel="prefetch" href="/assets/js/184.3cc82813.js"><link rel="prefetch" href="/assets/js/185.99065715.js"><link rel="prefetch" href="/assets/js/186.a74f7df2.js"><link rel="prefetch" href="/assets/js/187.3f02b774.js"><link rel="prefetch" href="/assets/js/188.847a2a1a.js"><link rel="prefetch" href="/assets/js/189.b9b8e037.js"><link rel="prefetch" href="/assets/js/19.0815011a.js"><link rel="prefetch" href="/assets/js/190.127126ab.js"><link rel="prefetch" href="/assets/js/191.40e749aa.js"><link rel="prefetch" href="/assets/js/192.a8f79d80.js"><link rel="prefetch" href="/assets/js/193.e7a7649d.js"><link rel="prefetch" href="/assets/js/194.7732785c.js"><link rel="prefetch" href="/assets/js/195.3b7b36a4.js"><link rel="prefetch" href="/assets/js/196.0553c0bc.js"><link rel="prefetch" href="/assets/js/197.ab84ca88.js"><link rel="prefetch" href="/assets/js/198.c67ae325.js"><link rel="prefetch" href="/assets/js/199.aae57de4.js"><link rel="prefetch" href="/assets/js/20.833ff123.js"><link rel="prefetch" href="/assets/js/200.6fa11ad2.js"><link rel="prefetch" href="/assets/js/201.84991f45.js"><link rel="prefetch" href="/assets/js/202.89b1f606.js"><link rel="prefetch" href="/assets/js/203.d11be478.js"><link rel="prefetch" href="/assets/js/204.dcf00bdc.js"><link rel="prefetch" href="/assets/js/205.aeba2176.js"><link rel="prefetch" href="/assets/js/206.05cb275b.js"><link rel="prefetch" href="/assets/js/207.0af7d3fa.js"><link rel="prefetch" href="/assets/js/208.c7cd0479.js"><link rel="prefetch" href="/assets/js/209.9ab558aa.js"><link rel="prefetch" href="/assets/js/21.c5fa79d4.js"><link rel="prefetch" href="/assets/js/210.afcdd546.js"><link rel="prefetch" href="/assets/js/211.5ecf0629.js"><link rel="prefetch" href="/assets/js/212.fa4c182b.js"><link rel="prefetch" href="/assets/js/213.fc38ab3f.js"><link rel="prefetch" href="/assets/js/215.397ef4b3.js"><link rel="prefetch" href="/assets/js/216.c9509985.js"><link rel="prefetch" href="/assets/js/217.e21b914e.js"><link rel="prefetch" href="/assets/js/218.ce2c4370.js"><link rel="prefetch" href="/assets/js/219.2f4b293d.js"><link rel="prefetch" href="/assets/js/22.c5329517.js"><link rel="prefetch" href="/assets/js/220.659ac064.js"><link rel="prefetch" href="/assets/js/221.f2576c40.js"><link rel="prefetch" href="/assets/js/222.7d32cfc3.js"><link rel="prefetch" href="/assets/js/23.10cdcaa0.js"><link rel="prefetch" href="/assets/js/24.8daade5f.js"><link rel="prefetch" href="/assets/js/25.13c56740.js"><link rel="prefetch" href="/assets/js/26.d189beaa.js"><link rel="prefetch" href="/assets/js/27.255faef5.js"><link rel="prefetch" href="/assets/js/28.000d4531.js"><link rel="prefetch" href="/assets/js/29.91a01258.js"><link rel="prefetch" href="/assets/js/3.448ef85a.js"><link rel="prefetch" href="/assets/js/30.26d2653e.js"><link rel="prefetch" href="/assets/js/31.100a97be.js"><link rel="prefetch" href="/assets/js/32.62bd0c64.js"><link rel="prefetch" href="/assets/js/33.3345a7f4.js"><link rel="prefetch" href="/assets/js/34.9eece916.js"><link rel="prefetch" href="/assets/js/35.99ff0d09.js"><link rel="prefetch" href="/assets/js/36.ed018d4e.js"><link rel="prefetch" href="/assets/js/37.35f40dcb.js"><link rel="prefetch" href="/assets/js/38.3fd40661.js"><link rel="prefetch" href="/assets/js/39.06af5a99.js"><link rel="prefetch" href="/assets/js/4.dbdcbb72.js"><link rel="prefetch" href="/assets/js/40.9e1542ea.js"><link rel="prefetch" href="/assets/js/41.799f4a68.js"><link rel="prefetch" href="/assets/js/42.d9ab491a.js"><link rel="prefetch" href="/assets/js/43.3aaaf769.js"><link rel="prefetch" href="/assets/js/44.281aa758.js"><link rel="prefetch" href="/assets/js/45.52523ac8.js"><link rel="prefetch" href="/assets/js/46.2e05fd22.js"><link rel="prefetch" href="/assets/js/47.015d44a4.js"><link rel="prefetch" href="/assets/js/48.9aee1cb8.js"><link rel="prefetch" href="/assets/js/49.58bbd949.js"><link rel="prefetch" href="/assets/js/5.9f60cafb.js"><link rel="prefetch" href="/assets/js/50.febf2ecb.js"><link rel="prefetch" href="/assets/js/51.a0116f99.js"><link rel="prefetch" href="/assets/js/52.89d8b497.js"><link rel="prefetch" href="/assets/js/53.08a27c82.js"><link rel="prefetch" href="/assets/js/54.53a73290.js"><link rel="prefetch" href="/assets/js/55.71c8d9da.js"><link rel="prefetch" href="/assets/js/56.1ed9d6b2.js"><link rel="prefetch" href="/assets/js/57.7947564a.js"><link rel="prefetch" href="/assets/js/58.3ea1ca43.js"><link rel="prefetch" href="/assets/js/59.9042021b.js"><link rel="prefetch" href="/assets/js/6.46ff1fa6.js"><link rel="prefetch" href="/assets/js/60.a132c685.js"><link rel="prefetch" href="/assets/js/61.55a034b5.js"><link rel="prefetch" href="/assets/js/62.21a3346e.js"><link rel="prefetch" href="/assets/js/63.f0f456c5.js"><link rel="prefetch" href="/assets/js/64.747bdb75.js"><link rel="prefetch" href="/assets/js/65.1915bf32.js"><link rel="prefetch" href="/assets/js/66.55e43e42.js"><link rel="prefetch" href="/assets/js/67.3136f15c.js"><link rel="prefetch" href="/assets/js/68.5cfaac48.js"><link rel="prefetch" href="/assets/js/69.efacf372.js"><link rel="prefetch" href="/assets/js/7.617779d1.js"><link rel="prefetch" href="/assets/js/70.aff0a4c3.js"><link rel="prefetch" href="/assets/js/71.f8f5bedc.js"><link rel="prefetch" href="/assets/js/72.f0c54e2f.js"><link rel="prefetch" href="/assets/js/73.b27bb580.js"><link rel="prefetch" href="/assets/js/74.4c1c0fc1.js"><link rel="prefetch" href="/assets/js/75.95188e04.js"><link rel="prefetch" href="/assets/js/76.3dbe9d5e.js"><link rel="prefetch" href="/assets/js/77.5fc958ed.js"><link rel="prefetch" href="/assets/js/78.cd045123.js"><link rel="prefetch" href="/assets/js/79.77b452ef.js"><link rel="prefetch" href="/assets/js/8.da9ae0f9.js"><link rel="prefetch" href="/assets/js/80.51667bf8.js"><link rel="prefetch" href="/assets/js/81.31db3f1e.js"><link rel="prefetch" href="/assets/js/82.eaf6d0d8.js"><link rel="prefetch" href="/assets/js/83.c47a2043.js"><link rel="prefetch" href="/assets/js/84.a221725b.js"><link rel="prefetch" href="/assets/js/85.48ba1f0a.js"><link rel="prefetch" href="/assets/js/86.97c7b948.js"><link rel="prefetch" href="/assets/js/87.9dd21ffa.js"><link rel="prefetch" href="/assets/js/88.062f33b5.js"><link rel="prefetch" href="/assets/js/89.f7b5f369.js"><link rel="prefetch" href="/assets/js/9.6f068f82.js"><link rel="prefetch" href="/assets/js/90.4da25cd1.js"><link rel="prefetch" href="/assets/js/91.d3fde5d2.js"><link rel="prefetch" href="/assets/js/92.5ceb0e87.js"><link rel="prefetch" href="/assets/js/93.3f645320.js"><link rel="prefetch" href="/assets/js/94.8771a754.js"><link rel="prefetch" href="/assets/js/95.3476a072.js"><link rel="prefetch" href="/assets/js/96.b2ff72c3.js"><link rel="prefetch" href="/assets/js/97.df180a7d.js"><link rel="prefetch" href="/assets/js/98.7c2d31cd.js"><link rel="prefetch" href="/assets/js/99.98e234fa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.482b2b4f.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/day-logo.png" alt="追光学院" class="logo"> <span class="site-name can-hide">追光学院</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WEB" class="dropdown-title"><a href="/web/" class="link-title">WEB</a> <span class="title" style="display:none;">WEB</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8143cc480faf9a11/" class="nav-link">JS学习心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UNITY" class="dropdown-title"><a href="/unity/" class="link-title">UNITY</a> <span class="title" style="display:none;">UNITY</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/unity/" class="nav-link">大屏可视化开发心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UREAL" class="dropdown-title"><a href="/ureal/" class="link-title">UREAL</a> <span class="title" style="display:none;">UREAL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ureal/" class="nav-link">大屏可视化开发心得</a></li></ul></div></div><div class="nav-item"><a href="/webgl/" class="nav-link">WEBGL</a></div><div class="nav-item"><a href="/xr/" class="nav-link">XR</a></div><div class="nav-item"><a href="/largedata/" class="nav-link">大数据</a></div><div class="nav-item"><a href="/digitaltwin/" class="nav-link">数字孪生</a></div><div class="nav-item"><a href="/ai/" class="nav-link">人工智能</a></div><div class="nav-item"><a href="/blockchain/" class="nav-link">区块链</a></div><div class="nav-item"><a href="/meta/" class="nav-link">元宇宙</a></div><div class="nav-item"><a href="/art/" class="nav-link">视觉艺术</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="练兵场" class="dropdown-title"><a href="/study/" class="link-title">练兵场</a> <span class="title" style="display:none;">练兵场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>WEB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/html5/" class="nav-link">HTML/CSS教程</a></li><li class="dropdown-subitem"><a href="/note/javascript-base/" class="nav-link">JS教程</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">ES6教程</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">VUE教程</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">TS教程</a></li></ul></li><li class="dropdown-item"><h4>UNITY3D</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/unity/" class="nav-link">TA进阶</a></li></ul></li><li class="dropdown-item"><h4>UREAL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ureal/" class="nav-link">TA进阶</a></li></ul></li><li class="dropdown-item"><h4>GIT</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">GIT</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/book/" class="nav-link">科幻屋</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/yangliangxii/blogsitecode" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avator.jpg"> <div class="blogger-info"><h3>Yang Liangxi</h3> <span>技术改变世界</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WEB" class="dropdown-title"><a href="/web/" class="link-title">WEB</a> <span class="title" style="display:none;">WEB</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8143cc480faf9a11/" class="nav-link">JS学习心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UNITY" class="dropdown-title"><a href="/unity/" class="link-title">UNITY</a> <span class="title" style="display:none;">UNITY</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/unity/" class="nav-link">大屏可视化开发心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="UREAL" class="dropdown-title"><a href="/ureal/" class="link-title">UREAL</a> <span class="title" style="display:none;">UREAL</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ureal/" class="nav-link">大屏可视化开发心得</a></li></ul></div></div><div class="nav-item"><a href="/webgl/" class="nav-link">WEBGL</a></div><div class="nav-item"><a href="/xr/" class="nav-link">XR</a></div><div class="nav-item"><a href="/largedata/" class="nav-link">大数据</a></div><div class="nav-item"><a href="/digitaltwin/" class="nav-link">数字孪生</a></div><div class="nav-item"><a href="/ai/" class="nav-link">人工智能</a></div><div class="nav-item"><a href="/blockchain/" class="nav-link">区块链</a></div><div class="nav-item"><a href="/meta/" class="nav-link">元宇宙</a></div><div class="nav-item"><a href="/art/" class="nav-link">视觉艺术</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="练兵场" class="dropdown-title"><a href="/study/" class="link-title">练兵场</a> <span class="title" style="display:none;">练兵场</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>WEB</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/html5/" class="nav-link">HTML/CSS教程</a></li><li class="dropdown-subitem"><a href="/note/javascript-base/" class="nav-link">JS教程</a></li><li class="dropdown-subitem"><a href="/note/es6/" class="nav-link">ES6教程</a></li><li class="dropdown-subitem"><a href="/note/vue/" class="nav-link">VUE教程</a></li><li class="dropdown-subitem"><a href="/note/typescript-axios/" class="nav-link">TS教程</a></li></ul></li><li class="dropdown-item"><h4>UNITY3D</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/unity/" class="nav-link">TA进阶</a></li></ul></li><li class="dropdown-item"><h4>UREAL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/ureal/" class="nav-link">TA进阶</a></li></ul></li><li class="dropdown-item"><h4>GIT</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/git/" class="nav-link">GIT</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/book/" class="nav-link">科幻屋</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/yangliangxii/blogsitecode" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>组件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>过渡&amp;动画</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>可复用性&amp;组合</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>规模化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuex</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Vue3源码解析</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1f344d070a1031ef7/" class="sidebar-link">Vue3源码解析(V3.2.45)-介绍及构建流程搭建</a></li><li><a href="/pages/2f344d070a1031ef7/" class="sidebar-link">Vue3源码解析(V3.2.45)-响应式源码分析与实现</a></li><li><a href="/pages/3f344d070a1031ef7/" aria-current="page" class="active sidebar-link">Vue3源码解析(V3.2.45)-渲染原理及diff算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/3f344d070a1031ef7/#vue3组件初始化过程" class="sidebar-link">vue3组件初始化过程</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f344d070a1031ef7/#runtime介绍" class="sidebar-link">runtime介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/3f344d070a1031ef7/#runtime-core介绍" class="sidebar-link">runtime-core介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#renderer" class="sidebar-link">renderer</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#component" class="sidebar-link">component</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#h函数" class="sidebar-link">h函数</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#apicreateapp" class="sidebar-link">apiCreateApp</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#componentpublicinstance" class="sidebar-link">componentPublicInstance</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#index" class="sidebar-link">index</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#scheduler" class="sidebar-link">scheduler</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#vnode" class="sidebar-link">vnode</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#sequence" class="sidebar-link">sequence</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/3f344d070a1031ef7/#runtime-dom介绍" class="sidebar-link">runtime-dom介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#index-2" class="sidebar-link">index</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#nodeops" class="sidebar-link">nodeOps</a></li><li class="sidebar-sub-header level3"><a href="/pages/3f344d070a1031ef7/#patchprop" class="sidebar-link">patchProp</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/note/vue/#Vue教程" data-v-06225672>Vue教程</a></li><li data-v-06225672><a href="/note/vue/#Vue3源码解析" data-v-06225672>Vue3源码解析</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>Yang Liangxi</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-08</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Vue3源码解析(V3.2.45)-渲染原理及diff算法<!----></h1>  <div class="theme-vdoing-content content__default"><blockquote><p>说明：本章内容为博主在原教程基础上添加自己的学习笔记，来源<a href="https://www.bilibili.com/video/BV1KB4y1g7jb?vd_source=a776fb95f6de3e1354e0f23cebc134d3" target="_blank" rel="noopener noreferrer">珠峰架构Vue3课程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，版权归原作者所有。</p></blockquote> <h1 id="渲染原理及diff算法"><a href="#渲染原理及diff算法" class="header-anchor">#</a> 渲染原理及diff算法</h1> <h2 id="vue3组件初始化过程"><a href="#vue3组件初始化过程" class="header-anchor">#</a> vue3组件初始化过程</h2> <p><img src="/img/vue3-init.jpg" alt="vue3组件初始化"> <center><strong>vue3组件初始化流程图-图片来源知乎社区</strong></center></p> <p><img src="/img/vue3-component-init.png" alt="vue3组件初始化"> <center><strong>vue3组件初始化流程图-图片来源珠峰社区</strong></center></p> <h2 id="runtime介绍"><a href="#runtime介绍" class="header-anchor">#</a> runtime介绍</h2> <p>vue3中将runtime模块分为runtime-core核心代码及其他平台对应的运行时。runtime-dom是解决浏览器运行时问题，此包封装了dom属性操作和节点操作的一系列接口</p> <ul><li>runtime-core：与平台无关的运行时核心</li> <li>runtime-dom：浏览器运行时，包括dom-api、属性和事件处理等</li> <li>runtime-test：运行时测试</li></ul> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>默认引入vue就是基于runtime-core和runtime-dom</p></div> <h2 id="runtime-core介绍"><a href="#runtime-core介绍" class="header-anchor">#</a> runtime-core介绍</h2> <ul><li>runtime-core不依赖任何平台(平台代码是被传入的)</li></ul> <h3 id="renderer"><a href="#renderer" class="header-anchor">#</a> renderer</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>//框架都是将组件转换成虚拟dom，然后通过虚拟dom生成真实dom，挂载到页面上
//虚拟dom可以做对比，多次操作可以一起更新

import { effect } from &quot;@vue/reactivity&quot;
import { ShapeFlags } from &quot;@vue/shared&quot;
import { createAppApi } from &quot;./apiCreateApp&quot;
import { createComponentInstance, setupComponent } from &quot;./component&quot;
import { queueJob } from &quot;./scheduler&quot;
import { normalizeVNode, Text } from &quot;./vnode&quot;

export function createRender(rendererOptions) {//告诉core怎么渲染
    const {
        insert: hostInsert,
        remove: hostRemove,
        patchProp: hostPatchProp,
        createElement: hostCreateElement,
        createText: hostCreateText,
        createComment: hostCreateComment,
        setText: hostSetText,
        setElementText: hostSetElementText,
        parentNode: hostParentNode,
        nextSibling: hostNextSibling,
    } = rendererOptions

    const setupRenderEffect = (instance, container) =&gt; {
        //需要创建一个effect方法 在effect中调用render，render中拿到的数据会收集这个effect，属性更新时effect会重新执行
        effect(function componentEffect() {//每个组件都有一个effect，vue3是组件级effect，数据变化重新执行对应组件的effect
            if (!instance.isMounted) {//表示初次挂载，初次渲染
                let proxyToUse = instance.proxy
                let subTree = instance.subTree = instance.render.call(proxyToUse, proxyToUse)
                //用render的返回值继续渲染
                patch(null, subTree, container)
                instance.isMounted = true
                console.log(subTree)
            } else {//更新
                const prevTree = instance.subTree
                let proxyToUse = instance.proxy
                const nextTree = instance.render.call(proxyToUse, proxyToUse)
                patch(prevTree, nextTree, container)
            }
        }, {
            scheduler: queueJob
        })
        instance.render()
    }

    const render = (vnode, container) =&gt; {
        //core的核心方法
        //根据不同的虚拟节点创建真是的元素

        //默认调用初始化流程
        patch(null, vnode, container)
    }

    const mountComponent = (initalizeVNode, container) =&gt; {
        console.log(initalizeVNode, container)
        //组件的渲染流程
        //先创建实例
        const instance = (initalizeVNode.component = createComponentInstance(initalizeVNode))
        //需要的数据解析到实例上
        setupComponent(instance)
        //创建一个effect让render函数执行
        setupRenderEffect(instance, container)
    }

    const patchProps = (oldProps, newProps, el) =&gt; {
        if (oldProps === newProps) {
            return
        }
        for (const key in newProps) {
            const prev = oldProps[key]
            const next = newProps[key]
            if (prev !== next) {
                hostPatchProp(el, key, prev, next)
            }
        }
        for (const key in oldProps) {
            if (!(key in newProps)) {
                hostPatchProp(el, key, oldProps[key], null)
            }
        }

    }

    const unmountChildren = (children) =&gt; {
        for (let i = 0; i &lt; children.length; i++) {
            unmount(children[i])
        }
    }

    //比较两个key
    const patchKeyedChildren = (c1, c2, el) =&gt; {
        //vue3对特殊情况进行优化
        let i = 0
        let e1 = c1.length - 1
        let e2 = c2.length - 1

        //尽可能减少比对的情况

        while (i &lt;= e1 &amp;&amp; i &lt;= e2) {
            const n1 = c1[i]
            const n2 = c2[i]
            if (isSameNVodeType(n1, n2)) {
                patch(n1, n2, el)
            } else {
                break
            }
            i++
        }

        while (i &lt;= e1 &amp;&amp; i &lt;= e2) {
            const n1 = c1[e1]
            const n2 = c2[e2]
            if (isSameNVodeType(n1, n2)) {
                patch(n1, n2, el)
            } else {
                break
            }
            e1--
            e2--
        }

        //比较后，有一方已经完全比对完毕了

        if (i &gt; e1) {//老的少  新的多
            if (i &lt;= e2) {//表示有新增部分
                //想知道是向前插入还是向后插入
                const nextPos = e2 + 1
                const anchor = nextPos &lt; c2.length ? c2[nextPos].el : null
                while (i &lt;= e2) {
                    patch(null, c2[i], el, anchor)//只是向后追加
                    i++
                }
            }
        } else if (i &gt; e2) {//老的多新的少
            if (i &lt;= e1) {
                while (i &lt;= e1) {
                    unmount(c1[i])
                    i++
                }
            } else {
                //乱序比较，需要尽可能复用，用新的元素做成一个映射表去老的里查找，一样的就复用，不一样的要不插入要不删除
                let s1 = i
                let s2 = i
                //vue3用的是新的做映射表  vue2用的是老的做映射表
                const keyToNewIndexMap = new Map()

                for (let i = s2; i &lt;= e2; i++) {
                    const childVnode = c2[i]
                    keyToNewIndexMap.set(childVnode.key, i)
                }

                const toBePatched = e2 - s2 + 1
                const newIndexToOldIndexMap = new Array(toBePatched).fill(0)

                for (let i = s1; i &lt;= e1; i++) {
                    const oldVnode = c1[i]
                    let newIndex = keyToNewIndexMap.get(oldVnode.key)
                    if (newIndex === undefined) {
                        unmount(oldVnode)
                    } else {
                        newIndexToOldIndexMap[newIndex - s2] = i + 1
                        patch(oldVnode, c2[newIndex], el)//patch的操作，是不是会复用元素，更新属性，比较儿子
                    }
                }

                let increasingNewIndexSequence = getSequence(newIndexToOldIndexMap)
                let j = increasingNewIndexSequence.length - 1
                console.info(increasingNewIndexSequence)

                for (let i = toBePatched - 1; i &gt;= 0; i--) {
                    let currentIndex = i + s2//找到索引
                    let child = c2[currentIndex]//找到索引对应的项
                    let anchor = currentIndex + 1 &lt; c2.length ? c2[currentIndex + 1].el : null
                    //第一次插入h后，h是第一个虚拟节点，同时插入后，虚拟节点会拥有真实节点

                    if (newIndexToOldIndexMap[i] == 0) {//如果自己是0说明没有被patch过
                        patch(null, child, el, anchor)
                    } else {

                        if (i == increasingNewIndexSequence[j]) {
                            j--//跳过不需要移动的物体，为了减少移动，需要这个最长子序列递增算法
                        } else {
                            hostInsert(child.el, el, anchor)//操作当前的d 以d下一个作为参照物插入
                        }
                    }
                }

                //最后就移动节点并且将新增节点插入


                //最长递增子序列
            }
        }
    }

    const patchChildren = (oldNode, newNode, el) =&gt; {
        const c1 = oldNode.children
        const c2 = newNode.children

        //老的有儿子  新的没儿子  新的有儿子老的没儿子  新老都有儿子  新老都是文本
        const prevShapeFlag = oldNode.shapeFlags
        const shapeFlag = newNode.shapeFlags
        if (shapeFlag &amp; ShapeFlags.TEXT_CHILDREN) {//case1 现在是文本之前是数组
            //老的是n个孩子，但是新的文本
            if (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) {
                unmountChildren(c1)
            }

            //两个都是文本的情况
            if (c2 != c1) {//case2 两个都是文本
                hostSetElementText(el, c2)
            }
        } else {
            //现在是元素 上一次可能是文本或者数组
            //两个数组的比对(diff算法)*****************比较复杂
            if (prevShapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) {//上次是数组//case3 两个都是数组
                if (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) {//这次也是数组
                    patchKeyedChildren(c1, c2, el)
                } else {//没有孩子
                    unmountChildren(c1)
                }
            } else {
                //上一次是文本
                if (prevShapeFlag &amp; ShapeFlags.TEXT_CHILDREN) {//case4 现在是数组之前是文本
                    hostSetElementText(el, &quot;&quot;)
                }
                //这次是数组
                if (shapeFlag &amp; ShapeFlags.ARRAY_CHILDREN) {
                    mountChildren(c2, el)
                }
            }
        }
    }

    const getSequence = (arr) =&gt; {
        const len = arr.length
        const result = [0]//默认第0个为参照物
        let p = arr.slice(0)//里面内容无所谓 和原本的数组相同 用来存放索引
        let start
        let end
        let middle

        for (let i = 0; i &lt; len; i++) {
            const arrI = arr[i]
            if (arrI !== 0) {
                let resultLastIndex = result[result.length - 1]
                if (arr[resultLastIndex] &lt; arrI) {
                    p[i] = resultLastIndex//标记当前前一个对应的索引
                    result.push(i)
                    continue
                }
            }

            //二分查找，找到比当前值大的那一个
            start = 0
            end = result.length - 1
            while (start &lt; end) {
                middle = ((start + end) / 2) | 0
                if (arr[result[middle]] &lt; arrI) {
                    start = middle + 1
                } else {
                    end = middle
                }//找到结果集中比当前这一项大的数

                if (arrI &lt; arr[result[start]]) {
                    if (start &gt; 0) {
                        p[i] = result[start - 1]//将它替换成前一个
                    }
                    result[start] = i
                }
            }
        }

        let len1 = result.length
        let last = result[len1 - 1]
        while (len1-- &gt; 0) {//根据前驱节点一个个向前查找
            result[len1] = last
            last = p[last]
        }
        return result;
    }

    const patchElement = (oldNode, newNode, container) =&gt; {
        //元素是相同根节点
        let el = (oldNode.el = newNode.el)
        //更新属性  更新儿子
        const oldProps = oldNode.props || {}
        const newProps = newNode.props || {}

        patchProps(oldProps, newProps, el)

        patchChildren(oldNode, newNode, el)
    }

    const processComponent = (oldNode, newNode, container) =&gt; {
        if (oldNode == null) {//组件没有上次的虚拟节点
            mountComponent(newNode, container)
        } else {
            //组件更新流程
            patchElement(oldNode, newNode, container)
        }
    }

    const mountChildren = (children, container) =&gt; {
        for (let i = 0; i &lt; children.length; i++) {
            let child = normalizeVNode(children[i])
            patch(null, child, container)
        }
    }

    const mountElement = (vnode, container, anchor = null) =&gt; {
        const { props, shapeFlags, type, children } = vnode
        let el = (vnode.el = hostCreateElement(type))
        if (props) {
            for (const key in props) {
                hostPatchProp(el, key, null, props[key])
            }
        }
        if (shapeFlags &amp; ShapeFlags.TEXT_CHILDREN) {
            hostSetElementText(el, children)
        } else if (shapeFlags &amp; ShapeFlags.ARRAY_CHILDREN) {
            mountChildren(children, el)
        }

        hostInsert(el, container, anchor)
    }

    const processElement = (oldNode, newNode, container, anchor) =&gt; {
        if (oldNode == null) {
            mountElement(newNode, container, anchor)
        }
    }

    const processText = (oldNode, newNode, container) =&gt; {
        if (oldNode == null) {
            hostInsert((newNode.el = hostCreateText(newNode.children)), container)
        }
    }

    const isSameNVodeType = (oldNode, newNode) =&gt; {
        return oldNode.type === newNode.type &amp;&amp; oldNode.key === newNode.key
    }

    const unmount = (oldNode) =&gt; {
        hostRemove(oldNode.el)
    }

    const patch = (oldNode, newNode, container, anchor = null) =&gt; {
        //针对不同类型做初始化操作
        const { shapeFlags, type } = newNode

        if (oldNode &amp;&amp; !isSameNVodeType(oldNode, newNode)) {
            anchor = hostNextSibling(oldNode.el)
            //把以前的删掉换成新的
            unmount(oldNode)
            oldNode = null//重新渲染 
        }

        switch (type) {
            case Text:
                processText(oldNode, newNode, container)
                break;
            default:
                if (shapeFlags &amp; ShapeFlags.ELEMENT) {//判断下shapeflags是否是元素
                    console.log('元素')
                    processElement(oldNode, newNode, container, anchor)
                } else if (shapeFlags &amp; shapeFlags.STATEFUL_COMPONENT) {
                    console.log('组件')
                    processComponent(oldNode, newNode, container)
                }
        }
    }

    return {
        createApp: createAppApi(render)
    }
}

// vue3组件创建的过程
// 将组件变成虚拟节点vnode,再将vnode变成真实dom，然后插入到页面中
// render方法的作用是可以渲染一个虚拟节点，将他挂载在具体的dom元素上
// vue3执行的核心就在patch这个方法上

// 创建组件的流程
// 先创建一个instance---&gt;初始化
// 根据用户传入的组件，拿到对应的内容，来填充这个instance这个对象
// 创建effect方法并调用render方法，数据会将对应的effect收集起来
// 拿到render方法的返回结果，再次走渲染流程-&gt;patch

// 组件渲染的顺序是先父后子，执行顺序是深度优先

// 每个组件都是一个effect函数
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br></div></div><center> renderer.ts </center> <h3 id="component"><a href="#component" class="header-anchor">#</a> component</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>//组件中所有方法

import { isFunction, isObject, ShapeFlags } from &quot;@vue/shared&quot;
import { PublicInstanceProxyHandlers } from &quot;./componentPublicInstance&quot;

export function createComponentInstance(vnode) {
    const instance = { //组件的实例
        vnode,
        type: vnode.type,
        props: {},
        atrrs: {},
        slots: {},
        ctx: null,
        setupState: {},//如果setup返回一个对象，那么这个对象作为setupState
        isMounted: false,//表示组件是否被挂载
    }
    instance.ctx = { _: instance }
    return instance
}

export function setupComponent(instance) {
    const { props, children } = instance.vnode
    //根据props解析出props和attrs
    instance.children = children//插槽的解析initSlot()
    instance.props = props//初始化initProps()

    //需要看下当前组件是不是有状态的组件，函数组件
    let isStateful = instance.vnode.shapeFlags &amp; ShapeFlags.STATEFUL_COMPONENT
    if (isStateful) {//表示现在是一个带状态的组件
        //调用当前的setup方法，用setup返回值填充setupState和对应的render方法
        setupStatefulComponent(instance)
    }

}

function setupStatefulComponent(instance) {
    //1代理，传递给函数的参数
    instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers as any)
    //2获取组件的类型，拿到组件的setup方法
    let component = instance.type
    let { setup } = component
    let setupContext = createSetupContext(instance)//instance中的props attrs slots emit expose都被提取出来
    if (setup) {
        let setupResult = setup(instance.props, setupContext)
        // component.render(instance.proxy)测试用
        handleSetupResult(instance, setupResult)
    } else {
        finishComponentSetup(instance)//完成组件的启动
    }
}

function handleSetupResult(instance, setupResult) {
    if (isFunction(setupResult)) {
        instance.render = setupResult
    } else if (isObject(setupResult)) {
        instance.setupState = setupResult
    }
    finishComponentSetup(instance)
}

function finishComponentSetup(instance) {
    let component = instance.type
    const { render } = component
    if (!instance.render) {//对template模板进行编译产生render函数
        //instance.render = render//将生成的render函数放在实例上
        if (!component.render &amp;&amp; component.template) {
         //编译将结果赋给component.render 
         //再赋给instace.render
        }
        instance.render = component.render
    }
    //对vue2.x做了兼容
    //applyOptions
}

function createSetupContext(instance) {
    return {
        attrs: instance.atrrs,
        slots: instance.slots,
        // props: instance.props,
        emit: () =&gt; { },
        expose: () =&gt; { }
    }
}

//instance 表示组件的状态，各种各样的状态
//context 是为了开发时使用
//proxy 主要是为了取值方便
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><center> component.ts </center> <h3 id="h函数"><a href="#h函数" class="header-anchor">#</a> h函数</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { isArray, isObject } from &quot;@vue/shared&quot;
import { createVNode, isVNode } from &quot;./vnode&quot;

export function h(type, propsOrChildren, children) {
    let l = arguments.length//儿子节点要么是字符串要么是数组，针对的是createVNode
    if (l == 2) {//类型+属性  类型+孩子
        //如果第二个参数不是对象，那就是孩子
        //如果是数组直接作为第三个参数
        if (isObject(propsOrChildren) &amp;&amp; !isArray(propsOrChildren)) {
            if (isVNode(propsOrChildren)) {
                return createVNode(type, null, [propsOrChildren])
            }
            return createVNode(type, propsOrChildren)

        } else {
            return createVNode(type, null, propsOrChildren)
        }
    }
    else {
        if (l &gt; 3) {
            children = Array.prototype.slice.call(arguments, 2)
        } else if (l === 3 &amp;&amp; isVNode(children)) {
            children = [children]
        }

        return createVNode(type, propsOrChildren, children)
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><center> h.ts </center> <h3 id="apicreateapp"><a href="#apicreateapp" class="header-anchor">#</a> apiCreateApp</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { createVNode } from &quot;./vnode&quot;

export function createAppApi(render) {
    return function createApp(rootComponent, rootProps) {//告诉core用哪个组件哪个属性创建应用
        const app = {
            _rootProps: rootProps,
            _rootComponent: rootComponent,
            _container: null,
            mount(container) {//挂载的地方
                // let vnode = {}

                //流程
                //1根据组件创建虚拟节点
                //2虚拟节点和容器获取到后，调用renderer方法

                //创建虚拟节点
                const vnode = createVNode(rootComponent, rootProps)
                console.info(vnode)
                //调用render方法
                render(vnode, container)//将vnode渲染后容器上
                app._container = container
            }
        }
        return app
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><center> apiCreateApp.ts </center> <h3 id="componentpublicinstance"><a href="#componentpublicinstance" class="header-anchor">#</a> componentPublicInstance</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>import { hasOwn } from &quot;@vue/shared&quot;

export const PublicInstanceProxyHandlers = {
    get({ _: instance }, key) {
        const { setupState, props, data } = instance
        if (key[0] === &quot;$&quot;) return //不能访问$开头的变量
        if (hasOwn(setupState, key)) {
            return setupState[key];
        } else if (hasOwn(props, key)) {
            return props[key]
        } else if (hasOwn(data, key)) {
            return data[key]
        } else {
            return undefined
        }
    },
    set({ _: instance }, key, value) {
        const { setupState, props, data } = instance
        if (hasOwn(setupState, key)) {
            setupState[key] = value;
        } else if (hasOwn(props, key)) {
            props[key] = value
        } else if (hasOwn(data, key)) {
            data[key] = value
        } else {
            return false
        }

        return true
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><center> componentPublicInstance.ts </center> <h3 id="index"><a href="#index" class="header-anchor">#</a> index</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>export { createRender } from './renderer'
export { h } from './h'

export * from &quot;@vue/reactivity&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><center> index.ts </center> <h3 id="scheduler"><a href="#scheduler" class="header-anchor">#</a> scheduler</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>let queue = []
export function queueJob(job) {
    if (!queue.includes(job)) {
        queue.push(job)
        queueFlush()
    }
}

let isFlushPeding = false

export function queueFlush() {
    if (!isFlushPeding) {
        isFlushPeding = true
        Promise.resolve().then(flushJobs)
    }
}

function flushJobs() {
    isFlushPeding = false
    //先刷新父再刷新子
    queue.sort((a, b) =&gt; a.id - b.id)

    for (let i = 0; i &lt; queue.length; i++) {
        const job = queue[i]
        job()
    }

    queue.length = 0
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><center> scheduler.ts </center> <h3 id="vnode"><a href="#vnode" class="header-anchor">#</a> vnode</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>
//h方法就是创建虚拟节点的vnode

import { isArray, isObject, isString, ShapeFlags } from &quot;@vue/shared&quot;

export function isVNode(vnode) {
    return vnode.__v_isNode
}

export function createVNode(type, props, children = null) {
    //根据type来区分是元素还是对象

    //根据type来区分是元素(字符串)还是组件(对象)
    const shapeFlags = isString(type) ? ShapeFlags.ELEMENT : isObject(type) ? ShapeFlags.COMPONENT : 0


    //给虚拟节点加一个类型
    const vnode = {//一个对象来描述对应的内容，虚拟节点具有跨平台的功能
        __v_isNode: true,
        type,
        props,
        children,
        component: null,//存放组件对应的实例
        el: null,//稍后会将虚拟节点和真是节点对应起来
        key: props &amp;&amp; props.key,//diff算法会用到key
        shapeFlags
    }
    normalizeChildren(vnode, children)
    return vnode
}

function normalizeChildren(vnode, children) {
    let type = 0
    if (children == null) {//不对儿子进行处理

    } else if (isArray(children)) {
        type = ShapeFlags.ARRAY_CHILDREN//表示儿子是个数组
    } else {
        type = ShapeFlags.TEXT_CHILDREN
    }
    vnode.shapeFlags = vnode.shapeFlags | type
}

export const Text = Symbol('Text')

export function normalizeVNode(child) {
    if (isObject(child)) return child
    return createVNode(Text, null, String(child))
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><center> vnode.ts </center> <h3 id="sequence"><a href="#sequence" class="header-anchor">#</a> sequence</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>const arr = [2, 3, 1, 5, 6, 8, 7, 9, 4]

function getSequence(arr) {
    const len = arr.length
    const result = [0]//默认第0个为参照物
    let p = arr.slice(0)//里面内容无所谓 和原本的数组相同 用来存放索引
    let start
    let end
    let middle

    for (let i = 0; i &lt; len; i++) {
        const arrI = arr[i]
        if (arrI !== 0) {
            let resultLastIndex = result[result.length - 1]
            if (arr[resultLastIndex] &lt; arrI) {
                p[i] = resultLastIndex//标记当前前一个对应的索引
                result.push(i)
                continue
            }
        }

        //二分查找，找到比当前值大的那一个
        start = 0
        end = result.length - 1
        while (start &lt; end) {
            middle = ((start + end) / 2) | 0
            if (arr[result[middle]] &lt; arrI) {
                start = middle + 1
            } else {
                end = middle
            }//找到结果集中比当前这一项大的数

            if (arrI &lt; arr[result[start]]) {
                if (start &gt; 0) {
                    p[i] = result[start - 1]//将它替换成前一个
                }
                result[start] = i
            }
        }
    }

    let len1 = result.length
    let last = result[len1 - 1]
    while (len1-- &gt; 0) {//根据前驱节点一个个向前查找
        result[len1] = last
        last = p[last]
    }
    return result;
}

console.log(getSequence(arr))
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><center> sequence.ts </center> <h2 id="runtime-dom介绍"><a href="#runtime-dom介绍" class="header-anchor">#</a> runtime-dom介绍</h2> <ul><li>需要涵盖dom操作api，属性操作api，事件操作api，并将这些api传入到runtime-core中运行</li> <li>我们在渲染页面的时候进行的节点操作的一系列方法</li></ul> <h3 id="index-2"><a href="#index-2" class="header-anchor">#</a> index</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>//这个包的核心就是提供dom api的，操作节点、操作属性的更新
//1节点操作无非就是增删改查
//2属性操作无非就是样式、类、事件、普通事件、其他属性的增删改

import { extend } from &quot;@vue/shared&quot;;
import { nodePos } from &quot;./nodeOps&quot;;
import { patchProp } from &quot;./patchProp&quot;;
import { createRender } from &quot;@vue/runtime-core&quot;

//渲染时用到的所有方法
export const rendererOptions = extend({ patchProp }, nodePos)

// vue-runtime-core里提供了核心的渲染方法，用来处理渲染，他会使用runtime-dom中的api进行渲染
export function createApp(rootComponent, rootProps = null) {
    const app: any = createRender(rendererOptions).createApp(rootComponent, rootProps)
    let { mount } = app
    app.mount = function (container) {
        container = document.querySelector(container)
        container.innerHTML = ''
        //将组件渲染成dom元素进行挂载
        mount(container)
    }
    return app
}

export * from '@vue/runtime-core'
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><center> index.ts </center> <h3 id="nodeops"><a href="#nodeops" class="header-anchor">#</a> nodeOps</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>export const nodePos = {
    //createElement，不同的平台创建元素的方式不同

    //元素
    createElement: (tagName) =&gt; document.createElement(tagName),//增加
    remove: (child) =&gt; {//删除
        const parent = child.parentNode
        if (parent) {
            parent.removeChild(child)
        }
    },
    insert: (child, parent, anchor = null) =&gt; {
        parent.insertBefore(child, anchor)//如果anchor为空，相当于appendChild
    },
    querySelector: (selector) =&gt; document.querySelector(selector),//查询
    setElementText: (el, text) =&gt; el.textContent = text,//设置文本内容
    nextSibling: (node) =&gt; node.nextSibling,
    
    //文本操作，创建文本
    createText: (text) =&gt; document.createTextNode(text),//创建文本
    setText: (node, text) =&gt; node.nodeValue = text,//给节点设置文本
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><center> nodeOps.ts </center> <h3 id="patchprop"><a href="#patchprop" class="header-anchor">#</a> patchProp</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>//这里面针对是一系列属性操作

import { patchAttr } from &quot;./modules/attr&quot;
import { patchClass } from &quot;./modules/class&quot;
import { patchEvents } from &quot;./modules/events&quot;
import { patchStyle } from &quot;./modules/style&quot;

export const patchProp = (el, key, preValue, nextValue) =&gt; {
    switch (key) {
        case 'class':
            patchClass(el, nextValue)
            break
        case 'style':
            patchStyle(el, preValue, nextValue)
            break
        default:
            if (/^on[^a-z]/.test(key)) {
                patchEvents(el, key, nextValue)
            } else {
                patchAttr(el, key, nextValue)
            }
            break
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><center> patchProp.ts </center></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/yangliangxii/blogsitecode/edit/master/docs/Vue教程/111.Vue3源码解析/03.渲染原理及diff算法.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Vue3" title="标签">#Vue3</a><a href="/tags/?tag=%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86%E5%8F%8Adiff%E7%AE%97%E6%B3%95" title="标签">#渲染原理及diff算法</a></div> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/2f344d070a1031ef7/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Vue3源码解析(V3.2.45)-响应式源码分析与实现</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/2f344d070a1031ef7/" class="prev">Vue3源码解析(V3.2.45)-响应式源码分析与实现</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/2f344d070a1031ef7/"><div>
            Vue3源码解析(V3.2.45)-响应式源码分析与实现
            <!----></div></a> <span class="date">12-07</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/1f344d070a1031ef7/"><div>
            Vue3源码解析(V3.2.45)-介绍及构建流程搭建
            <!----></div></a> <span class="date">12-06</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/55f894/"><div>
            CSS给table的tbody添加滚动条
            <!----></div></a> <span class="date">06-29</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:287077203@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/yangliangxii" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
    Power from Vdoing| Copyright © 2019-2022
    <span>Yang Liangxi</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.17c3de54.js" defer></script><script src="/assets/js/2.712e115f.js" defer></script><script src="/assets/js/214.706faf32.js" defer></script>
  </body>
</html>
