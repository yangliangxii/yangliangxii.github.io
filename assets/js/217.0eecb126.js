(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{542:function(e,s,n){"use strict";n.r(s);var t=n(3),a=Object(t.a)({},(function(){var e=this,s=e._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("blockquote",[s("p",[e._v("说明：本章内容为博主在原教程基础上添加自己的学习笔记，来源"),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1KB4y1g7jb?vd_source=a776fb95f6de3e1354e0f23cebc134d3",target:"_blank",rel:"noopener noreferrer"}},[e._v("珠峰架构Vue3课程"),s("OutboundLink")],1),e._v("，版权归原作者所有。")])]),e._v(" "),s("h1",{attrs:{id:"vue3介绍及构建流程搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3介绍及构建流程搭建"}},[e._v("#")]),e._v(" Vue3介绍及构建流程搭建")]),e._v(" "),s("h2",{attrs:{id:"区别介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#区别介绍"}},[e._v("#")]),e._v(" 区别介绍")]),e._v(" "),s("ul",[s("li",[e._v("源码采用monorepo方式进行管理，将模块拆分到packages目录中")]),e._v(" "),s("li",[e._v("vue3采用ts开发，增强类型检查，vue2则采用flow")]),e._v(" "),s("li",[e._v("vue3的性能优化，支持tree-shaking，打包时会剔除未被使用的代码\n"),s("ul",[s("li",[e._v("vue3劫持数据采用es6 Proxy，支持数组；vue2采用defineProperty，而defineProperty有性能问题和缺陷，不支持数组，需单独处理")]),e._v(" "),s("li",[e._v("vue3中对模板编译进行了优化，编译时生成了Block tree，可以对子节点的动态节点进行收集，可以减少比较，并且采用了patchFlag标记动态节点")]),e._v(" "),s("li",[e._v("vue3使用组合式api，vue2使用配置式api，用户提供的data，props，computed，methods，watch等属性，用户编写复杂的逻辑时会在这些属性间频繁横跳")]),e._v(" "),s("li",[e._v("vue2所有的属性都通过this指向，复杂逻辑会造成指向不明确问题")]),e._v(" "),s("li",[e._v("vue2使用mixins实现组件间的逻辑共享，但会有数据来源不明确，命名冲突等问题，vue3使用composition api提供公共逻辑非常方便")])])]),e._v(" "),s("li",[e._v("vue2后期引入RFC，使每个版本改动可控rfcs")]),e._v(" "),s("li",[e._v("vue3新增了Fragment，Teleport，Suspense组件")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("monorepo优点")]),e._v(" "),s("ul",[s("li",[e._v("monorepo是项目管理的一个方式，在一个项目仓库中管理多个包/模块，将代码拆分到各个模块package中")]),e._v(" "),s("li",[e._v("一个仓库维护多个模块，不用到处找仓库")]),e._v(" "),s("li",[e._v("方便版本管理和依赖管理，模块之间的调用和引用都非常方便")]),e._v(" "),s("li",[e._v("模块扩展非常方便")])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("tree-shaking介绍")]),e._v(" "),s("ul",[s("li",[e._v("tree-shaking是一种消除死代码的性能优化理论，最初由rollup提出概念，目前支持的工具有：rollup，webpack2，closure complier等")]),e._v(" "),s("li",[e._v("tree-shaking实现原理\n"),s("ul",[s("li",[e._v("tree-shaking的本质是消除无用的js代码，同时它也是DCE(Dead Code Elimination)的一种新的实现")]),e._v(" "),s("li",[e._v("与传统语言不同的，JavaScript加载由于受网络影响使得DCE具有更重要的意义，毕竟JS文件越小加载时间越短")]),e._v(" "),s("li",[e._v("具体实现DCE的并不是之前提到的三个工具，而是代码压缩优化工具uglify")]),e._v(" "),s("li",[e._v("tree-shaking是基于es6的模块特性，这也是该工具之前不能流行的原因")])])])])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("uglify特征")]),e._v(" "),s("ul",[s("li",[e._v("函数消除：rollup与webpack2都可以实现，rollup相对效率更高")]),e._v(" "),s("li",[e._v("类消除：rollup与webpack2都无法实现")]),e._v(" "),s("li",[e._v("rollup只处理函数和顶层的import/export变量，不能把没用到的类的方法消除掉")]),e._v(" "),s("li",[e._v("uglify不能跨文件消除代码")])])]),e._v(" "),s("div",{staticClass:"custom-block danger"},[s("p",{staticClass:"custom-block-title"},[e._v("tree-shaking副作用")]),e._v(" "),s("ul",[s("li",[e._v("side effects是指那些当import的时候会执行一些动作，但是不一定会有任何export，比如ployfill，ployfills不对外暴露方法给主程序使用")]),e._v(" "),s("li",[e._v("tree-shaking不能自动的识别哪些代码属于side effects，因此手动指定这些代码显得非常重要，如果不指定可能会出现一些意想不到的问题")])])]),e._v(" "),s("h2",{attrs:{id:"架构分析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#架构分析"}},[e._v("#")]),e._v(" 架构分析")]),e._v(" "),s("ul",[s("li",[e._v("采用monorepo管理项目")]),e._v(" "),s("li",[e._v("项目结构\n"),s("ul",[s("li",[e._v("reactivity响应式系统")]),e._v(" "),s("li",[e._v("runtime-core与平台无关的运行时核心(可以借助其他运行时创建针对特定平台的运行时)")]),e._v(" "),s("li",[e._v("runtime-dom针对浏览器的运行时，包括dom api 、属性处理、事件处理等")]),e._v(" "),s("li",[e._v("runtime-test用于测试")]),e._v(" "),s("li",[e._v("server-renderer用于服务端渲染")]),e._v(" "),s("li",[e._v("compiler-core与平台无关的编译器核心")]),e._v(" "),s("li",[e._v("compiler-dom针对浏览器的编译器")]),e._v(" "),s("li",[e._v("compiler-ssr针对服务端渲染的编译器模块")]),e._v(" "),s("li",[e._v("compiler-sfc针对单文件解析的编译器模块")]),e._v(" "),s("li",[e._v("size-check用来测试代码体积")]),e._v(" "),s("li",[e._v("template-explorer用于调试编译器输出的开发工具")]),e._v(" "),s("li",[e._v("shared多个包之间共享的内容")]),e._v(" "),s("li",[e._v("vue完整版包括编译器和运行时")])])])]),e._v(" "),s("p",[s("img",{attrs:{src:"/img/vue3-src-jiagou.png",alt:"vue3源码工程结构图"}}),e._v(" "),s("center",[s("strong",[e._v("vue3架构图")])])],1),e._v(" "),s("h2",{attrs:{id:"环境搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境搭建"}},[e._v("#")]),e._v(" 环境搭建")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("node version： v16.17.1")])]),e._v(" "),s("ul",[s("li",[e._v("Step 0 - 创建"),s("code",[e._v("test-vue3-src")]),e._v("项目根目录")]),e._v(" "),s("li",[e._v("Step 1 - 根目录下执行"),s("code",[e._v("yarn init -y")]),e._v("命令初始化项目")]),e._v(" "),s("li",[e._v("Step 2 - 根目录下创建"),s("code",[e._v("packages")]),e._v("目录")]),e._v(" "),s("li",[e._v("Step 3 - 创建如下目录并执行命令"),s("code",[e._v("yarn init -y")]),e._v("初始化\n"),s("ul",[s("li",[e._v("packages/reactivity")]),e._v(" "),s("li",[e._v("packages/shared")]),e._v(" "),s("li",[e._v("packages/runtime-core")]),e._v(" "),s("li",[e._v("packages/runtime-dom")]),e._v(" "),s("li",[e._v("其他包名")])])]),e._v(" "),s("li",[e._v("Step 4 - 在每个"),s("code",[e._v("/packages/*/src/")]),e._v("目录下新建"),s("code",[e._v("index.ts")]),e._v("文件")]),e._v(" "),s("li",[e._v("Step 5 - 在根目录下执行命令"),s("code",[e._v("npx tsc --init")]),e._v("生成"),s("code",[e._v("tsconfig.json")]),e._v("文件")])]),e._v(" "),s("div",{staticClass:"language-reactivity包package.json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  {\n      "name": "@vue/reactivity",//将所有的包都统一放置在@vue下\n      "version": "1.0.0",\n      "main": "index.js",//commonjs入口\n      "module": "dist/reactivity.esm-bundler.js",//webpack入口\n      "unpkg": "dist/reactivity.global.js",//window入口\n      "license": "MIT",\n      "buildOptions": {//自定义配置项\n          "name": "VueReactivity",//global全局模块的名字，如果不打包global可以不起名字\n          "formats": [//当前包(模块)可以构建成的格式有哪些\n              "esm-bundler",//es6模块，es6用法 <script type=\'modual\'>这样可以使用es6语法<\/script>\n              "cjs",//commonjs模块，node平台下使用\n              "global"//全局模块，浏览器直接<srcrip src=\'VueReactivity.global.js\'>这样就直接引入了js中的东西<\/script>引入\n          ]\n      }\n  }\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br")])]),s("center",[e._v("reactivity包package.json")]),e._v(" "),s("div",{staticClass:"language-shared包package.json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  {\n      "name": "@vue/shared",\n      "version": "1.0.0",\n      "main": "index.js",\n      "module": "dist/shared.esm-bundler.js",\n      "license": "MIT",\n      "buildOptions": {\n          "name": "VueShared",//global全局模块的名字，如果不打包global可以不起名字\n          "formats": [\n              "esm-bundler",\n              "cjs"\n          ]\n      }\n  }\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])]),s("center",[e._v("shared包package.json")]),e._v(" "),s("ul",[s("li",[e._v("Step 6 - 在根目录下执行命令"),s("code",[e._v("yarn add typescript@^4.8.0 rollup@^3.2.3 rollup-plugin-typescript2@^0.34.1 @rollup/plugin-node-resolve@^15.0.1 @rollup/plugin-json@^5.0.1 @rollup/plugin-commonjs@^23.0.2 execa@^4.0.2 minimist@^1.2.0 -D -W")]),e._v("安装所需依赖和工具")])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("注意：-W参数")]),e._v(" "),s("p",[e._v("意思是这些依赖是给当前项目的根目录安装的，不是给下面的某个包安装")])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("依赖工具的用途")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("rollup")]),e._v("打包工具")]),e._v(" "),s("li",[s("code",[e._v("@rollup/plugin-node-resolve")]),e._v("rollup和第三方模块的桥梁")]),e._v(" "),s("li",[s("code",[e._v("@rollup/plugin-json")]),e._v("rollup和json的桥梁")]),e._v(" "),s("li",[s("code",[e._v("execa")]),e._v("开启子进程方便执行命令")]),e._v(" "),s("li",[s("code",[e._v("@rollup-plugin-typescript2")]),e._v("rollup和typescript的桥梁")]),e._v(" "),s("li",[s("code",[e._v("@rollup/plugin-commonjs")]),e._v("rollup和commonjs模块的桥梁")]),e._v(" "),s("li",[s("code",[e._v("minimist")]),e._v("轻量级的命令行参数解析引擎")])])]),e._v(" "),s("ul",[s("li",[e._v("Step 7 - 在根目录下创建"),s("code",[e._v("scripts")]),e._v("目录并创建"),s("code",[e._v("dev.js")]),e._v("文件和"),s("code",[e._v("build.js")]),e._v("文件")])]),e._v(" "),s("div",{staticClass:"language-根目录下包package.json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    {\n      "private": true,//私有的\n      "workspaces": [//模块都在packages下统一管理\n        "packages/*"\n      ],\n      "name": "test-vue3-src",\n      "version": "1.0.0",\n      "description": "vue3源码",\n      "main": "index.js",\n      "author": "ylx",\n      "license": "MIT",\n      "scripts": {\n        "dev": "node scripts/dev.js",//开发环境\n        "build": "node scripts/build.js"//生产环境\n      },\n      "devDependencies": {\n        "@rollup/plugin-commonjs": "^23.0.2",\n        "@rollup/plugin-json": "^5.0.1",\n        "@rollup/plugin-node-resolve": "^15.0.1",\n        "execa": "^4.0.2",\n        "minimist": "^1.2.0",\n        "rollup": "^3.2.3",\n        "rollup-plugin-typescript2": "^0.34.1",\n        "typescript": "^4.8.0"\n      }\n  }\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br")])]),s("center",[e._v("此时的根目录下包package.json")]),e._v(" "),s("ul",[s("li",[e._v("Step 8 - 实现"),s("code",[e._v("scripts/build.js")]),e._v("功能")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  //对packages目录下的所有模块都进行打包\n  const fs = require(\'fs\')//文件操作\n  const execa = require(\'execa\')//开启子进程，最终还是使用rollup打包\n\n  const targets = fs.readdirSync(\'packages\').filter((f) => {\n      if (!fs.statSync(`packages/${f}`).isDirectory()) {\n          return false\n      }\n      return true\n  })//不加filter就是在根目录下的packages中找到所有的包目录和文件，filter可以过滤掉不是目录的文件\n  console.info(`找到的所有包名：${targets}`)\n\n  //找到目标后，我们需要依次并行打包之\n  //打包函数，使用rollup进行打包\n  async function build(target) {\n      console.info(`需要打包的目标有：${target}`)\n      // rollup -c --environment "TARGET":xxxx \n      await execa("rollup", ["-c", "--environment", `TARGET:${target}`], { stdio: "inherit" })//stdio:"inherit"子进程打包的信息共享给父进程\n  }\n\n  //并行打包函数\n  function runParallel(targets, iteratorFn) {//iteratorFn是迭代函数\n      let res = []\n      for (const iterator of targets) {\n          const p = iteratorFn(iterator)//每个打包的过程都是一个promise\n          res.push(p)\n      }\n      return Promise.all(res)//返回所有异步打包对象\n  }\n\n  //并行打包所有目标，没打包一个模块执行一次build\n  runParallel(targets, build)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br")])]),s("center",[e._v("build.js代码")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('  {\n    "compilerOptions": {\n      /* Visit https://aka.ms/tsconfig to read more about this file */\n\n      /* Projects */\n      // "incremental": true,                              /* Save .tsbuildinfo files to allow for incremental compilation of projects. */\n      // "composite": true,                                /* Enable constraints that allow a TypeScript project to be used with project references. */\n      // "tsBuildInfoFile": "./.tsbuildinfo",              /* Specify the path to .tsbuildinfo incremental compilation file. */\n      // "disableSourceOfProjectReferenceRedirect": true,  /* Disable preferring source files instead of declaration files when referencing composite projects. */\n      // "disableSolutionSearching": true,                 /* Opt a project out of multi-project reference checking when editing. */\n      // "disableReferencedProjectLoad": true,             /* Reduce the number of projects loaded automatically by TypeScript. */\n\n      /* Language and Environment */\n      "target": "ESNEXT",                                  /* Set the JavaScript language version for emitted JavaScript and include compatible library declarations. */\n      // "lib": [],                                        /* Specify a set of bundled library declaration files that describe the target runtime environment. */\n      // "jsx": "preserve",                                /* Specify what JSX code is generated. */\n      // "experimentalDecorators": true,                   /* Enable experimental support for TC39 stage 2 draft decorators. */\n      // "emitDecoratorMetadata": true,                    /* Emit design-type metadata for decorated declarations in source files. */\n      // "jsxFactory": "",                                 /* Specify the JSX factory function used when targeting React JSX emit, e.g. \'React.createElement\' or \'h\'. */\n      // "jsxFragmentFactory": "",                         /* Specify the JSX Fragment reference used for fragments when targeting React JSX emit e.g. \'React.Fragment\' or \'Fragment\'. */\n      // "jsxImportSource": "",                            /* Specify module specifier used to import the JSX factory functions when using \'jsx: react-jsx*\'. */\n      // "reactNamespace": "",                             /* Specify the object invoked for \'createElement\'. This only applies when targeting \'react\' JSX emit. */\n      // "noLib": true,                                    /* Disable including any library files, including the default lib.d.ts. */\n      // "useDefineForClassFields": true,                  /* Emit ECMAScript-standard-compliant class fields. */\n      // "moduleDetection": "auto",                        /* Control what method is used to detect module-format JS files. */\n\n      /* Modules */\n      "module": "ESNEXT",                                  /* Specify what module code is generated. */\n      // "rootDir": "./",                                  /* Specify the root folder within your source files. */\n      // "moduleResolution": "node",                       /* Specify how TypeScript looks up a file from a given module specifier. */\n      // "baseUrl": "./",                                  /* Specify the base directory to resolve non-relative module names. */\n      // "paths": {},                                      /* Specify a set of entries that re-map imports to additional lookup locations. */\n      // "rootDirs": [],                                   /* Allow multiple folders to be treated as one when resolving modules. */\n      // "typeRoots": [],                                  /* Specify multiple folders that act like \'./node_modules/@types\'. */\n      // "types": [],                                      /* Specify type package names to be included without being referenced in a source file. */\n      // "allowUmdGlobalAccess": true,                     /* Allow accessing UMD globals from modules. */\n      // "moduleSuffixes": [],                             /* List of file name suffixes to search when resolving a module. */\n      // "resolveJsonModule": true,                        /* Enable importing .json files. */\n      // "noResolve": true,                                /* Disallow \'import\'s, \'require\'s or \'<reference>\'s from expanding the number of files TypeScript should add to a project. */\n\n      /* JavaScript Support */\n      // "allowJs": true,                                  /* Allow JavaScript files to be a part of your program. Use the \'checkJS\' option to get errors from these files. */\n      // "checkJs": true,                                  /* Enable error reporting in type-checked JavaScript files. */\n      // "maxNodeModuleJsDepth": 1,                        /* Specify the maximum folder depth used for checking JavaScript files from \'node_modules\'. Only applicable with \'allowJs\'. */\n\n      /* Emit */\n      // "declaration": true,                              /* Generate .d.ts files from TypeScript and JavaScript files in your project. */\n      // "declarationMap": true,                           /* Create sourcemaps for d.ts files. */\n      // "emitDeclarationOnly": true,                      /* Only output d.ts files and not JavaScript files. */\n         "sourceMap": true,                                /* Create source map files for emitted JavaScript files. */\n      // "outFile": "./",                                  /* Specify a file that bundles all outputs into one JavaScript file. If \'declaration\' is true, also designates a file that bundles all .d.ts output. */\n      // "outDir": "./",                                   /* Specify an output folder for all emitted files. */\n      // "removeComments": true,                           /* Disable emitting comments. */\n      // "noEmit": true,                                   /* Disable emitting files from a compilation. */\n      // "importHelpers": true,                            /* Allow importing helper functions from tslib once per project, instead of including them per-file. */\n      // "importsNotUsedAsValues": "remove",               /* Specify emit/checking behavior for imports that are only used for types. */\n      // "downlevelIteration": true,                       /* Emit more compliant, but verbose and less performant JavaScript for iteration. */\n      // "sourceRoot": "",                                 /* Specify the root path for debuggers to find the reference source code. */\n      // "mapRoot": "",                                    /* Specify the location where debugger should locate map files instead of generated locations. */\n      // "inlineSourceMap": true,                          /* Include sourcemap files inside the emitted JavaScript. */\n      // "inlineSources": true,                            /* Include source code in the sourcemaps inside the emitted JavaScript. */\n      // "emitBOM": true,                                  /* Emit a UTF-8 Byte Order Mark (BOM) in the beginning of output files. */\n      // "newLine": "crlf",                                /* Set the newline character for emitting files. */\n      // "stripInternal": true,                            /* Disable emitting declarations that have \'@internal\' in their JSDoc comments. */\n      // "noEmitHelpers": true,                            /* Disable generating custom helper functions like \'__extends\' in compiled output. */\n      // "noEmitOnError": true,                            /* Disable emitting files if any type checking errors are reported. */\n      // "preserveConstEnums": true,                       /* Disable erasing \'const enum\' declarations in generated code. */\n      // "declarationDir": "./",                           /* Specify the output directory for generated declaration files. */\n      // "preserveValueImports": true,                     /* Preserve unused imported values in the JavaScript output that would otherwise be removed. */\n\n      /* Interop Constraints */\n      // "isolatedModules": true,                          /* Ensure that each file can be safely transpiled without relying on other imports. */\n      // "allowSyntheticDefaultImports": true,             /* Allow \'import x from y\' when a module doesn\'t have a default export. */\n      "esModuleInterop": true,                             /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables \'allowSyntheticDefaultImports\' for type compatibility. */\n      // "preserveSymlinks": true,                         /* Disable resolving symlinks to their realpath. This correlates to the same flag in node. */\n      "forceConsistentCasingInFileNames": true,            /* Ensure that casing is correct in imports. */\n\n      /* Type Checking */\n      "strict": false,                                      /* Enable all strict type-checking options. */\n      // "noImplicitAny": true,                            /* Enable error reporting for expressions and declarations with an implied \'any\' type. */\n      // "strictNullChecks": true,                         /* When type checking, take into account \'null\' and \'undefined\'. */\n      // "strictFunctionTypes": true,                      /* When assigning functions, check to ensure parameters and the return values are subtype-compatible. */\n      // "strictBindCallApply": true,                      /* Check that the arguments for \'bind\', \'call\', and \'apply\' methods match the original function. */\n      // "strictPropertyInitialization": true,             /* Check for class properties that are declared but not set in the constructor. */\n      // "noImplicitThis": true,                           /* Enable error reporting when \'this\' is given the type \'any\'. */\n      // "useUnknownInCatchVariables": true,               /* Default catch clause variables as \'unknown\' instead of \'any\'. */\n      // "alwaysStrict": true,                             /* Ensure \'use strict\' is always emitted. */\n      // "noUnusedLocals": true,                           /* Enable error reporting when local variables aren\'t read. */\n      // "noUnusedParameters": true,                       /* Raise an error when a function parameter isn\'t read. */\n      // "exactOptionalPropertyTypes": true,               /* Interpret optional property types as written, rather than adding \'undefined\'. */\n      // "noImplicitReturns": true,                        /* Enable error reporting for codepaths that do not explicitly return in a function. */\n      // "noFallthroughCasesInSwitch": true,               /* Enable error reporting for fallthrough cases in switch statements. */\n      // "noUncheckedIndexedAccess": true,                 /* Add \'undefined\' to a type when accessed using an index. */\n      // "noImplicitOverride": true,                       /* Ensure overriding members in derived classes are marked with an override modifier. */\n      // "noPropertyAccessFromIndexSignature": true,       /* Enforces using indexed accessors for keys declared using an indexed type. */\n      // "allowUnusedLabels": true,                        /* Disable error reporting for unused labels. */\n      // "allowUnreachableCode": true,                     /* Disable error reporting for unreachable code. */\n\n      /* Completeness */\n      // "skipDefaultLibCheck": true,                      /* Skip type checking .d.ts files that are included with TypeScript. */\n      "skipLibCheck": true                                 /* Skip type checking all .d.ts files. */\n    }\n  }\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br"),s("span",{staticClass:"line-number"},[e._v("38")]),s("br"),s("span",{staticClass:"line-number"},[e._v("39")]),s("br"),s("span",{staticClass:"line-number"},[e._v("40")]),s("br"),s("span",{staticClass:"line-number"},[e._v("41")]),s("br"),s("span",{staticClass:"line-number"},[e._v("42")]),s("br"),s("span",{staticClass:"line-number"},[e._v("43")]),s("br"),s("span",{staticClass:"line-number"},[e._v("44")]),s("br"),s("span",{staticClass:"line-number"},[e._v("45")]),s("br"),s("span",{staticClass:"line-number"},[e._v("46")]),s("br"),s("span",{staticClass:"line-number"},[e._v("47")]),s("br"),s("span",{staticClass:"line-number"},[e._v("48")]),s("br"),s("span",{staticClass:"line-number"},[e._v("49")]),s("br"),s("span",{staticClass:"line-number"},[e._v("50")]),s("br"),s("span",{staticClass:"line-number"},[e._v("51")]),s("br"),s("span",{staticClass:"line-number"},[e._v("52")]),s("br"),s("span",{staticClass:"line-number"},[e._v("53")]),s("br"),s("span",{staticClass:"line-number"},[e._v("54")]),s("br"),s("span",{staticClass:"line-number"},[e._v("55")]),s("br"),s("span",{staticClass:"line-number"},[e._v("56")]),s("br"),s("span",{staticClass:"line-number"},[e._v("57")]),s("br"),s("span",{staticClass:"line-number"},[e._v("58")]),s("br"),s("span",{staticClass:"line-number"},[e._v("59")]),s("br"),s("span",{staticClass:"line-number"},[e._v("60")]),s("br"),s("span",{staticClass:"line-number"},[e._v("61")]),s("br"),s("span",{staticClass:"line-number"},[e._v("62")]),s("br"),s("span",{staticClass:"line-number"},[e._v("63")]),s("br"),s("span",{staticClass:"line-number"},[e._v("64")]),s("br"),s("span",{staticClass:"line-number"},[e._v("65")]),s("br"),s("span",{staticClass:"line-number"},[e._v("66")]),s("br"),s("span",{staticClass:"line-number"},[e._v("67")]),s("br"),s("span",{staticClass:"line-number"},[e._v("68")]),s("br"),s("span",{staticClass:"line-number"},[e._v("69")]),s("br"),s("span",{staticClass:"line-number"},[e._v("70")]),s("br"),s("span",{staticClass:"line-number"},[e._v("71")]),s("br"),s("span",{staticClass:"line-number"},[e._v("72")]),s("br"),s("span",{staticClass:"line-number"},[e._v("73")]),s("br"),s("span",{staticClass:"line-number"},[e._v("74")]),s("br"),s("span",{staticClass:"line-number"},[e._v("75")]),s("br"),s("span",{staticClass:"line-number"},[e._v("76")]),s("br"),s("span",{staticClass:"line-number"},[e._v("77")]),s("br"),s("span",{staticClass:"line-number"},[e._v("78")]),s("br"),s("span",{staticClass:"line-number"},[e._v("79")]),s("br"),s("span",{staticClass:"line-number"},[e._v("80")]),s("br"),s("span",{staticClass:"line-number"},[e._v("81")]),s("br"),s("span",{staticClass:"line-number"},[e._v("82")]),s("br"),s("span",{staticClass:"line-number"},[e._v("83")]),s("br"),s("span",{staticClass:"line-number"},[e._v("84")]),s("br"),s("span",{staticClass:"line-number"},[e._v("85")]),s("br"),s("span",{staticClass:"line-number"},[e._v("86")]),s("br"),s("span",{staticClass:"line-number"},[e._v("87")]),s("br"),s("span",{staticClass:"line-number"},[e._v("88")]),s("br"),s("span",{staticClass:"line-number"},[e._v("89")]),s("br"),s("span",{staticClass:"line-number"},[e._v("90")]),s("br"),s("span",{staticClass:"line-number"},[e._v("91")]),s("br"),s("span",{staticClass:"line-number"},[e._v("92")]),s("br"),s("span",{staticClass:"line-number"},[e._v("93")]),s("br"),s("span",{staticClass:"line-number"},[e._v("94")]),s("br"),s("span",{staticClass:"line-number"},[e._v("95")]),s("br"),s("span",{staticClass:"line-number"},[e._v("96")]),s("br"),s("span",{staticClass:"line-number"},[e._v("97")]),s("br"),s("span",{staticClass:"line-number"},[e._v("98")]),s("br"),s("span",{staticClass:"line-number"},[e._v("99")]),s("br"),s("span",{staticClass:"line-number"},[e._v("100")]),s("br"),s("span",{staticClass:"line-number"},[e._v("101")]),s("br"),s("span",{staticClass:"line-number"},[e._v("102")]),s("br"),s("span",{staticClass:"line-number"},[e._v("103")]),s("br")])]),s("center",[e._v("此时的tsconfig.json配置")]),e._v(" "),s("ul",[s("li",[e._v("Step 9 - 实现"),s("code",[e._v("scripts/dev.js")]),e._v("功能")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v(' //只针对某个具体的模块打包\n\n const fs = require(\'fs\')//文件操作\n const execa = require(\'execa\')//开启子进程，最终还是使用rollup打包\n\n // const targets = fs.readdirSync(\'packages\').filter((f) => {\n //     if (!fs.statSync(`packages/${f}`).isDirectory()) {\n //         return false\n //     }\n //     return true\n // })//不加filter就是在根目录下的packages中找到所有的包目录和文件，filter可以过滤掉不是目录的文件\n // console.info(`找到的所有包名--------\x3e`, targets)\n\n const target = \'reactivity\'//打包哪个模块就写哪个模块的名称\n\n //找到目标后，我们需要依次并行打包之\n //打包函数，使用rollup进行打包\n async function build(target) {\n     console.info(`需要打包的目标有---------\x3e`, target)\n     // rollup -cw --environment "TARGET":xxxx (TARGET这个名字可以随便起，rollup.config.js里引用时对应上即可)  -cw可以一直监视文件是否有变化，有变化则自动打包\n     await execa("rollup", ["-cw", "--environment", `TARGET:${target}`], { stdio: "inherit" })//stdio:"inherit"子进程打包的信息共享给父进程\n }\n\n build(target)\n\n //并行打包函数\n // function runParallel(targets, iteratorFn) {//iteratorFn是迭代函数\n //     let res = []\n //     for (const iterator of targets) {\n //         const p = iteratorFn(iterator)//每个打包的过程都是一个promise\n //         res.push(p)\n //     }\n //     return Promise.all(res)//返回所有异步打包对象\n // }\n\n // //并行打包所有目标，没打包一个模块执行一次build\n // runParallel(targets, build)\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br")])]),s("center",[e._v("dev.js打包代码")]),e._v(" "),s("ul",[s("li",[e._v("Step 10 - 根目录下创建"),s("code",[e._v("rollup.config.mjs")]),e._v("文件并实现功能")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("      //import execa from 'execa'\n      const fs = require('fs')//加载node模块\n      const execa = require('execa')\n\n      // 1 获取模块目录\n      //const dirs = fs.readdirSync('packages'); //使用fs核心模块读取packages下所有目录，包括文件\n      //console.info(dirs);\n\n      const dirs = fs.readdirSync('packages').filter(f => {\n          if (!fs.statSync(`packages/${f}`).isDirectory()) {\n              return false\n          }\n          return true\n      }); //使用fs核心模块读取packages下所有目录，包括文件,使用filter方法过滤掉不是目录的文件名\n      console.info(dirs);\n\n      // 2 并行打包\n      async function build(target) {\n          console.info(target, '<--build--\x3e');\n          //rollup表示打包工具  -c表示执行rollup的配置  --environment环境变量\n          await execa('rollup', ['-c', '--environment', `TARGET:${target}`], { stdio: 'inherit' });\n      }\n\n      async function runParaller(dirs, itemfn) {\n          let result = [];\n          for (let item of dirs) {\n              result.push(itemfn(item));\n          }\n          return Promise.all(result);//存放打包的promise\n      }\n\n      runParaller(dirs, build).then(() => {\n          console.info(\"打包成功\");\n      });\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br")])]),e._v(" "),s("center",[e._v("rollup.config.mjs代码")]),e._v(" "),s("h2",{attrs:{id:"包之间相互引用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#包之间相互引用"}},[e._v("#")]),e._v(" 包之间相互引用")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("安装包")]),e._v(" "),s("ul",[s("li",[e._v("执行yarn install 就可以在根目录下的node_modules中生成@vue/xxxx每个包的软链(快捷方式)")]),e._v(" "),s("li",[e._v("在其他类中使用 import * from '@vue/xxxx'，即可引入相应的包中的函数、对象、变量")])])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("依赖包安装")]),e._v(" "),s("ul",[s("li",[e._v("yarn workspace @vue/reactivity add @vue/shared")])])])],1)}),[],!1,null,null,null);s.default=a.exports}}]);