(window.webpackJsonp=window.webpackJsonp||[]).push([[225],{549:function(n,s,e){"use strict";e.r(s);var a=e(3),t=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("blockquote",[s("p",[n._v("说明：本章内容为博主在原教程基础上添加自己的学习笔记，来源"),s("a",{attrs:{href:"https://www.bilibili.com/video/BV1KB4y1g7jb?vd_source=a776fb95f6de3e1354e0f23cebc134d3",target:"_blank",rel:"noopener noreferrer"}},[n._v("珠峰架构Vue3课程"),s("OutboundLink")],1),n._v("，版权归原作者所有。")])]),n._v(" "),s("h1",{attrs:{id:"渲染原理及diff算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#渲染原理及diff算法"}},[n._v("#")]),n._v(" 渲染原理及diff算法")]),n._v(" "),s("h2",{attrs:{id:"vue3组件初始化过程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue3组件初始化过程"}},[n._v("#")]),n._v(" vue3组件初始化过程")]),n._v(" "),s("p",[s("img",{attrs:{src:"/img/vue3-init.jpg",alt:"vue3组件初始化"}}),n._v(" "),s("center",[s("strong",[n._v("vue3组件初始化流程图-图片来源知乎社区")])])],1),n._v(" "),s("p",[s("img",{attrs:{src:"/img/vue3-component-init.png",alt:"vue3组件初始化"}}),n._v(" "),s("center",[s("strong",[n._v("vue3组件初始化流程图-图片来源珠峰社区")])])],1),n._v(" "),s("h2",{attrs:{id:"runtime介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#runtime介绍"}},[n._v("#")]),n._v(" runtime介绍")]),n._v(" "),s("p",[n._v("vue3中将runtime模块分为runtime-core核心代码及其他平台对应的运行时。runtime-dom是解决浏览器运行时问题，此包封装了dom属性操作和节点操作的一系列接口")]),n._v(" "),s("ul",[s("li",[n._v("runtime-core：与平台无关的运行时核心")]),n._v(" "),s("li",[n._v("runtime-dom：浏览器运行时，包括dom-api、属性和事件处理等")]),n._v(" "),s("li",[n._v("runtime-test：运行时测试")])]),n._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[n._v("提示")]),n._v(" "),s("p",[n._v("默认引入vue就是基于runtime-core和runtime-dom")])]),n._v(" "),s("h2",{attrs:{id:"runtime-core介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#runtime-core介绍"}},[n._v("#")]),n._v(" runtime-core介绍")]),n._v(" "),s("ul",[s("li",[n._v("runtime-core不依赖任何平台(平台代码是被传入的)")])]),n._v(" "),s("h3",{attrs:{id:"renderer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#renderer"}},[n._v("#")]),n._v(" renderer")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('//框架都是将组件转换成虚拟dom，然后通过虚拟dom生成真实dom，挂载到页面上\n//虚拟dom可以做对比，多次操作可以一起更新\n\nimport { effect } from "@vue/reactivity"\nimport { ShapeFlags } from "@vue/shared"\nimport { createAppApi } from "./apiCreateApp"\nimport { createComponentInstance, setupComponent } from "./component"\nimport { queueJob } from "./scheduler"\nimport { normalizeVNode, Text } from "./vnode"\n\nexport function createRender(rendererOptions) {//告诉core怎么渲染\n    const {\n        insert: hostInsert,\n        remove: hostRemove,\n        patchProp: hostPatchProp,\n        createElement: hostCreateElement,\n        createText: hostCreateText,\n        createComment: hostCreateComment,\n        setText: hostSetText,\n        setElementText: hostSetElementText,\n        parentNode: hostParentNode,\n        nextSibling: hostNextSibling,\n    } = rendererOptions\n\n    const setupRenderEffect = (instance, container) => {\n        //需要创建一个effect方法 在effect中调用render，render中拿到的数据会收集这个effect，属性更新时effect会重新执行\n        effect(function componentEffect() {//每个组件都有一个effect，vue3是组件级effect，数据变化重新执行对应组件的effect\n            if (!instance.isMounted) {//表示初次挂载，初次渲染\n                let proxyToUse = instance.proxy\n                let subTree = instance.subTree = instance.render.call(proxyToUse, proxyToUse)\n                //用render的返回值继续渲染\n                patch(null, subTree, container)\n                instance.isMounted = true\n                console.log(subTree)\n            } else {//更新\n                const prevTree = instance.subTree\n                let proxyToUse = instance.proxy\n                const nextTree = instance.render.call(proxyToUse, proxyToUse)\n                patch(prevTree, nextTree, container)\n            }\n        }, {\n            scheduler: queueJob\n        })\n        instance.render()\n    }\n\n    const render = (vnode, container) => {\n        //core的核心方法\n        //根据不同的虚拟节点创建真是的元素\n\n        //默认调用初始化流程\n        patch(null, vnode, container)\n    }\n\n    const mountComponent = (initalizeVNode, container) => {\n        console.log(initalizeVNode, container)\n        //组件的渲染流程\n        //先创建实例\n        const instance = (initalizeVNode.component = createComponentInstance(initalizeVNode))\n        //需要的数据解析到实例上\n        setupComponent(instance)\n        //创建一个effect让render函数执行\n        setupRenderEffect(instance, container)\n    }\n\n    const patchProps = (oldProps, newProps, el) => {\n        if (oldProps === newProps) {\n            return\n        }\n        for (const key in newProps) {\n            const prev = oldProps[key]\n            const next = newProps[key]\n            if (prev !== next) {\n                hostPatchProp(el, key, prev, next)\n            }\n        }\n        for (const key in oldProps) {\n            if (!(key in newProps)) {\n                hostPatchProp(el, key, oldProps[key], null)\n            }\n        }\n\n    }\n\n    const unmountChildren = (children) => {\n        for (let i = 0; i < children.length; i++) {\n            unmount(children[i])\n        }\n    }\n\n    //比较两个key\n    const patchKeyedChildren = (c1, c2, el) => {\n        //vue3对特殊情况进行优化\n        let i = 0\n        let e1 = c1.length - 1\n        let e2 = c2.length - 1\n\n        //尽可能减少比对的情况\n\n        while (i <= e1 && i <= e2) {\n            const n1 = c1[i]\n            const n2 = c2[i]\n            if (isSameNVodeType(n1, n2)) {\n                patch(n1, n2, el)\n            } else {\n                break\n            }\n            i++\n        }\n\n        while (i <= e1 && i <= e2) {\n            const n1 = c1[e1]\n            const n2 = c2[e2]\n            if (isSameNVodeType(n1, n2)) {\n                patch(n1, n2, el)\n            } else {\n                break\n            }\n            e1--\n            e2--\n        }\n\n        //比较后，有一方已经完全比对完毕了\n\n        if (i > e1) {//老的少  新的多\n            if (i <= e2) {//表示有新增部分\n                //想知道是向前插入还是向后插入\n                const nextPos = e2 + 1\n                const anchor = nextPos < c2.length ? c2[nextPos].el : null\n                while (i <= e2) {\n                    patch(null, c2[i], el, anchor)//只是向后追加\n                    i++\n                }\n            }\n        } else if (i > e2) {//老的多新的少\n            if (i <= e1) {\n                while (i <= e1) {\n                    unmount(c1[i])\n                    i++\n                }\n            } else {\n                //乱序比较，需要尽可能复用，用新的元素做成一个映射表去老的里查找，一样的就复用，不一样的要不插入要不删除\n                let s1 = i\n                let s2 = i\n                //vue3用的是新的做映射表  vue2用的是老的做映射表\n                const keyToNewIndexMap = new Map()\n\n                for (let i = s2; i <= e2; i++) {\n                    const childVnode = c2[i]\n                    keyToNewIndexMap.set(childVnode.key, i)\n                }\n\n                const toBePatched = e2 - s2 + 1\n                const newIndexToOldIndexMap = new Array(toBePatched).fill(0)\n\n                for (let i = s1; i <= e1; i++) {\n                    const oldVnode = c1[i]\n                    let newIndex = keyToNewIndexMap.get(oldVnode.key)\n                    if (newIndex === undefined) {\n                        unmount(oldVnode)\n                    } else {\n                        newIndexToOldIndexMap[newIndex - s2] = i + 1\n                        patch(oldVnode, c2[newIndex], el)//patch的操作，是不是会复用元素，更新属性，比较儿子\n                    }\n                }\n\n                let increasingNewIndexSequence = getSequence(newIndexToOldIndexMap)\n                let j = increasingNewIndexSequence.length - 1\n                console.info(increasingNewIndexSequence)\n\n                for (let i = toBePatched - 1; i >= 0; i--) {\n                    let currentIndex = i + s2//找到索引\n                    let child = c2[currentIndex]//找到索引对应的项\n                    let anchor = currentIndex + 1 < c2.length ? c2[currentIndex + 1].el : null\n                    //第一次插入h后，h是第一个虚拟节点，同时插入后，虚拟节点会拥有真实节点\n\n                    if (newIndexToOldIndexMap[i] == 0) {//如果自己是0说明没有被patch过\n                        patch(null, child, el, anchor)\n                    } else {\n\n                        if (i == increasingNewIndexSequence[j]) {\n                            j--//跳过不需要移动的物体，为了减少移动，需要这个最长子序列递增算法\n                        } else {\n                            hostInsert(child.el, el, anchor)//操作当前的d 以d下一个作为参照物插入\n                        }\n                    }\n                }\n\n                //最后就移动节点并且将新增节点插入\n\n\n                //最长递增子序列\n            }\n        }\n    }\n\n    const patchChildren = (oldNode, newNode, el) => {\n        const c1 = oldNode.children\n        const c2 = newNode.children\n\n        //老的有儿子  新的没儿子  新的有儿子老的没儿子  新老都有儿子  新老都是文本\n        const prevShapeFlag = oldNode.shapeFlags\n        const shapeFlag = newNode.shapeFlags\n        if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {//case1 现在是文本之前是数组\n            //老的是n个孩子，但是新的文本\n            if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                unmountChildren(c1)\n            }\n\n            //两个都是文本的情况\n            if (c2 != c1) {//case2 两个都是文本\n                hostSetElementText(el, c2)\n            }\n        } else {\n            //现在是元素 上一次可能是文本或者数组\n            //两个数组的比对(diff算法)*****************比较复杂\n            if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {//上次是数组//case3 两个都是数组\n                if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {//这次也是数组\n                    patchKeyedChildren(c1, c2, el)\n                } else {//没有孩子\n                    unmountChildren(c1)\n                }\n            } else {\n                //上一次是文本\n                if (prevShapeFlag & ShapeFlags.TEXT_CHILDREN) {//case4 现在是数组之前是文本\n                    hostSetElementText(el, "")\n                }\n                //这次是数组\n                if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                    mountChildren(c2, el)\n                }\n            }\n        }\n    }\n\n    const getSequence = (arr) => {\n        const len = arr.length\n        const result = [0]//默认第0个为参照物\n        let p = arr.slice(0)//里面内容无所谓 和原本的数组相同 用来存放索引\n        let start\n        let end\n        let middle\n\n        for (let i = 0; i < len; i++) {\n            const arrI = arr[i]\n            if (arrI !== 0) {\n                let resultLastIndex = result[result.length - 1]\n                if (arr[resultLastIndex] < arrI) {\n                    p[i] = resultLastIndex//标记当前前一个对应的索引\n                    result.push(i)\n                    continue\n                }\n            }\n\n            //二分查找，找到比当前值大的那一个\n            start = 0\n            end = result.length - 1\n            while (start < end) {\n                middle = ((start + end) / 2) | 0\n                if (arr[result[middle]] < arrI) {\n                    start = middle + 1\n                } else {\n                    end = middle\n                }//找到结果集中比当前这一项大的数\n\n                if (arrI < arr[result[start]]) {\n                    if (start > 0) {\n                        p[i] = result[start - 1]//将它替换成前一个\n                    }\n                    result[start] = i\n                }\n            }\n        }\n\n        let len1 = result.length\n        let last = result[len1 - 1]\n        while (len1-- > 0) {//根据前驱节点一个个向前查找\n            result[len1] = last\n            last = p[last]\n        }\n        return result;\n    }\n\n    const patchElement = (oldNode, newNode, container) => {\n        //元素是相同根节点\n        let el = (oldNode.el = newNode.el)\n        //更新属性  更新儿子\n        const oldProps = oldNode.props || {}\n        const newProps = newNode.props || {}\n\n        patchProps(oldProps, newProps, el)\n\n        patchChildren(oldNode, newNode, el)\n    }\n\n    const processComponent = (oldNode, newNode, container) => {\n        if (oldNode == null) {//组件没有上次的虚拟节点\n            mountComponent(newNode, container)\n        } else {\n            //组件更新流程\n            patchElement(oldNode, newNode, container)\n        }\n    }\n\n    const mountChildren = (children, container) => {\n        for (let i = 0; i < children.length; i++) {\n            let child = normalizeVNode(children[i])\n            patch(null, child, container)\n        }\n    }\n\n    const mountElement = (vnode, container, anchor = null) => {\n        const { props, shapeFlags, type, children } = vnode\n        let el = (vnode.el = hostCreateElement(type))\n        if (props) {\n            for (const key in props) {\n                hostPatchProp(el, key, null, props[key])\n            }\n        }\n        if (shapeFlags & ShapeFlags.TEXT_CHILDREN) {\n            hostSetElementText(el, children)\n        } else if (shapeFlags & ShapeFlags.ARRAY_CHILDREN) {\n            mountChildren(children, el)\n        }\n\n        hostInsert(el, container, anchor)\n    }\n\n    const processElement = (oldNode, newNode, container, anchor) => {\n        if (oldNode == null) {\n            mountElement(newNode, container, anchor)\n        }\n    }\n\n    const processText = (oldNode, newNode, container) => {\n        if (oldNode == null) {\n            hostInsert((newNode.el = hostCreateText(newNode.children)), container)\n        }\n    }\n\n    const isSameNVodeType = (oldNode, newNode) => {\n        return oldNode.type === newNode.type && oldNode.key === newNode.key\n    }\n\n    const unmount = (oldNode) => {\n        hostRemove(oldNode.el)\n    }\n\n    const patch = (oldNode, newNode, container, anchor = null) => {\n        //针对不同类型做初始化操作\n        const { shapeFlags, type } = newNode\n\n        if (oldNode && !isSameNVodeType(oldNode, newNode)) {\n            anchor = hostNextSibling(oldNode.el)\n            //把以前的删掉换成新的\n            unmount(oldNode)\n            oldNode = null//重新渲染 \n        }\n\n        switch (type) {\n            case Text:\n                processText(oldNode, newNode, container)\n                break;\n            default:\n                if (shapeFlags & ShapeFlags.ELEMENT) {//判断下shapeflags是否是元素\n                    console.log(\'元素\')\n                    processElement(oldNode, newNode, container, anchor)\n                } else if (shapeFlags & shapeFlags.STATEFUL_COMPONENT) {\n                    console.log(\'组件\')\n                    processComponent(oldNode, newNode, container)\n                }\n        }\n    }\n\n    return {\n        createApp: createAppApi(render)\n    }\n}\n\n// vue3组件创建的过程\n// 将组件变成虚拟节点vnode,再将vnode变成真实dom，然后插入到页面中\n// render方法的作用是可以渲染一个虚拟节点，将他挂载在具体的dom元素上\n// vue3执行的核心就在patch这个方法上\n\n// 创建组件的流程\n// 先创建一个instance---\x3e初始化\n// 根据用户传入的组件，拿到对应的内容，来填充这个instance这个对象\n// 创建effect方法并调用render方法，数据会将对应的effect收集起来\n// 拿到render方法的返回结果，再次走渲染流程->patch\n\n// 组件渲染的顺序是先父后子，执行顺序是深度优先\n\n// 每个组件都是一个effect函数\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br"),s("span",{staticClass:"line-number"},[n._v("112")]),s("br"),s("span",{staticClass:"line-number"},[n._v("113")]),s("br"),s("span",{staticClass:"line-number"},[n._v("114")]),s("br"),s("span",{staticClass:"line-number"},[n._v("115")]),s("br"),s("span",{staticClass:"line-number"},[n._v("116")]),s("br"),s("span",{staticClass:"line-number"},[n._v("117")]),s("br"),s("span",{staticClass:"line-number"},[n._v("118")]),s("br"),s("span",{staticClass:"line-number"},[n._v("119")]),s("br"),s("span",{staticClass:"line-number"},[n._v("120")]),s("br"),s("span",{staticClass:"line-number"},[n._v("121")]),s("br"),s("span",{staticClass:"line-number"},[n._v("122")]),s("br"),s("span",{staticClass:"line-number"},[n._v("123")]),s("br"),s("span",{staticClass:"line-number"},[n._v("124")]),s("br"),s("span",{staticClass:"line-number"},[n._v("125")]),s("br"),s("span",{staticClass:"line-number"},[n._v("126")]),s("br"),s("span",{staticClass:"line-number"},[n._v("127")]),s("br"),s("span",{staticClass:"line-number"},[n._v("128")]),s("br"),s("span",{staticClass:"line-number"},[n._v("129")]),s("br"),s("span",{staticClass:"line-number"},[n._v("130")]),s("br"),s("span",{staticClass:"line-number"},[n._v("131")]),s("br"),s("span",{staticClass:"line-number"},[n._v("132")]),s("br"),s("span",{staticClass:"line-number"},[n._v("133")]),s("br"),s("span",{staticClass:"line-number"},[n._v("134")]),s("br"),s("span",{staticClass:"line-number"},[n._v("135")]),s("br"),s("span",{staticClass:"line-number"},[n._v("136")]),s("br"),s("span",{staticClass:"line-number"},[n._v("137")]),s("br"),s("span",{staticClass:"line-number"},[n._v("138")]),s("br"),s("span",{staticClass:"line-number"},[n._v("139")]),s("br"),s("span",{staticClass:"line-number"},[n._v("140")]),s("br"),s("span",{staticClass:"line-number"},[n._v("141")]),s("br"),s("span",{staticClass:"line-number"},[n._v("142")]),s("br"),s("span",{staticClass:"line-number"},[n._v("143")]),s("br"),s("span",{staticClass:"line-number"},[n._v("144")]),s("br"),s("span",{staticClass:"line-number"},[n._v("145")]),s("br"),s("span",{staticClass:"line-number"},[n._v("146")]),s("br"),s("span",{staticClass:"line-number"},[n._v("147")]),s("br"),s("span",{staticClass:"line-number"},[n._v("148")]),s("br"),s("span",{staticClass:"line-number"},[n._v("149")]),s("br"),s("span",{staticClass:"line-number"},[n._v("150")]),s("br"),s("span",{staticClass:"line-number"},[n._v("151")]),s("br"),s("span",{staticClass:"line-number"},[n._v("152")]),s("br"),s("span",{staticClass:"line-number"},[n._v("153")]),s("br"),s("span",{staticClass:"line-number"},[n._v("154")]),s("br"),s("span",{staticClass:"line-number"},[n._v("155")]),s("br"),s("span",{staticClass:"line-number"},[n._v("156")]),s("br"),s("span",{staticClass:"line-number"},[n._v("157")]),s("br"),s("span",{staticClass:"line-number"},[n._v("158")]),s("br"),s("span",{staticClass:"line-number"},[n._v("159")]),s("br"),s("span",{staticClass:"line-number"},[n._v("160")]),s("br"),s("span",{staticClass:"line-number"},[n._v("161")]),s("br"),s("span",{staticClass:"line-number"},[n._v("162")]),s("br"),s("span",{staticClass:"line-number"},[n._v("163")]),s("br"),s("span",{staticClass:"line-number"},[n._v("164")]),s("br"),s("span",{staticClass:"line-number"},[n._v("165")]),s("br"),s("span",{staticClass:"line-number"},[n._v("166")]),s("br"),s("span",{staticClass:"line-number"},[n._v("167")]),s("br"),s("span",{staticClass:"line-number"},[n._v("168")]),s("br"),s("span",{staticClass:"line-number"},[n._v("169")]),s("br"),s("span",{staticClass:"line-number"},[n._v("170")]),s("br"),s("span",{staticClass:"line-number"},[n._v("171")]),s("br"),s("span",{staticClass:"line-number"},[n._v("172")]),s("br"),s("span",{staticClass:"line-number"},[n._v("173")]),s("br"),s("span",{staticClass:"line-number"},[n._v("174")]),s("br"),s("span",{staticClass:"line-number"},[n._v("175")]),s("br"),s("span",{staticClass:"line-number"},[n._v("176")]),s("br"),s("span",{staticClass:"line-number"},[n._v("177")]),s("br"),s("span",{staticClass:"line-number"},[n._v("178")]),s("br"),s("span",{staticClass:"line-number"},[n._v("179")]),s("br"),s("span",{staticClass:"line-number"},[n._v("180")]),s("br"),s("span",{staticClass:"line-number"},[n._v("181")]),s("br"),s("span",{staticClass:"line-number"},[n._v("182")]),s("br"),s("span",{staticClass:"line-number"},[n._v("183")]),s("br"),s("span",{staticClass:"line-number"},[n._v("184")]),s("br"),s("span",{staticClass:"line-number"},[n._v("185")]),s("br"),s("span",{staticClass:"line-number"},[n._v("186")]),s("br"),s("span",{staticClass:"line-number"},[n._v("187")]),s("br"),s("span",{staticClass:"line-number"},[n._v("188")]),s("br"),s("span",{staticClass:"line-number"},[n._v("189")]),s("br"),s("span",{staticClass:"line-number"},[n._v("190")]),s("br"),s("span",{staticClass:"line-number"},[n._v("191")]),s("br"),s("span",{staticClass:"line-number"},[n._v("192")]),s("br"),s("span",{staticClass:"line-number"},[n._v("193")]),s("br"),s("span",{staticClass:"line-number"},[n._v("194")]),s("br"),s("span",{staticClass:"line-number"},[n._v("195")]),s("br"),s("span",{staticClass:"line-number"},[n._v("196")]),s("br"),s("span",{staticClass:"line-number"},[n._v("197")]),s("br"),s("span",{staticClass:"line-number"},[n._v("198")]),s("br"),s("span",{staticClass:"line-number"},[n._v("199")]),s("br"),s("span",{staticClass:"line-number"},[n._v("200")]),s("br"),s("span",{staticClass:"line-number"},[n._v("201")]),s("br"),s("span",{staticClass:"line-number"},[n._v("202")]),s("br"),s("span",{staticClass:"line-number"},[n._v("203")]),s("br"),s("span",{staticClass:"line-number"},[n._v("204")]),s("br"),s("span",{staticClass:"line-number"},[n._v("205")]),s("br"),s("span",{staticClass:"line-number"},[n._v("206")]),s("br"),s("span",{staticClass:"line-number"},[n._v("207")]),s("br"),s("span",{staticClass:"line-number"},[n._v("208")]),s("br"),s("span",{staticClass:"line-number"},[n._v("209")]),s("br"),s("span",{staticClass:"line-number"},[n._v("210")]),s("br"),s("span",{staticClass:"line-number"},[n._v("211")]),s("br"),s("span",{staticClass:"line-number"},[n._v("212")]),s("br"),s("span",{staticClass:"line-number"},[n._v("213")]),s("br"),s("span",{staticClass:"line-number"},[n._v("214")]),s("br"),s("span",{staticClass:"line-number"},[n._v("215")]),s("br"),s("span",{staticClass:"line-number"},[n._v("216")]),s("br"),s("span",{staticClass:"line-number"},[n._v("217")]),s("br"),s("span",{staticClass:"line-number"},[n._v("218")]),s("br"),s("span",{staticClass:"line-number"},[n._v("219")]),s("br"),s("span",{staticClass:"line-number"},[n._v("220")]),s("br"),s("span",{staticClass:"line-number"},[n._v("221")]),s("br"),s("span",{staticClass:"line-number"},[n._v("222")]),s("br"),s("span",{staticClass:"line-number"},[n._v("223")]),s("br"),s("span",{staticClass:"line-number"},[n._v("224")]),s("br"),s("span",{staticClass:"line-number"},[n._v("225")]),s("br"),s("span",{staticClass:"line-number"},[n._v("226")]),s("br"),s("span",{staticClass:"line-number"},[n._v("227")]),s("br"),s("span",{staticClass:"line-number"},[n._v("228")]),s("br"),s("span",{staticClass:"line-number"},[n._v("229")]),s("br"),s("span",{staticClass:"line-number"},[n._v("230")]),s("br"),s("span",{staticClass:"line-number"},[n._v("231")]),s("br"),s("span",{staticClass:"line-number"},[n._v("232")]),s("br"),s("span",{staticClass:"line-number"},[n._v("233")]),s("br"),s("span",{staticClass:"line-number"},[n._v("234")]),s("br"),s("span",{staticClass:"line-number"},[n._v("235")]),s("br"),s("span",{staticClass:"line-number"},[n._v("236")]),s("br"),s("span",{staticClass:"line-number"},[n._v("237")]),s("br"),s("span",{staticClass:"line-number"},[n._v("238")]),s("br"),s("span",{staticClass:"line-number"},[n._v("239")]),s("br"),s("span",{staticClass:"line-number"},[n._v("240")]),s("br"),s("span",{staticClass:"line-number"},[n._v("241")]),s("br"),s("span",{staticClass:"line-number"},[n._v("242")]),s("br"),s("span",{staticClass:"line-number"},[n._v("243")]),s("br"),s("span",{staticClass:"line-number"},[n._v("244")]),s("br"),s("span",{staticClass:"line-number"},[n._v("245")]),s("br"),s("span",{staticClass:"line-number"},[n._v("246")]),s("br"),s("span",{staticClass:"line-number"},[n._v("247")]),s("br"),s("span",{staticClass:"line-number"},[n._v("248")]),s("br"),s("span",{staticClass:"line-number"},[n._v("249")]),s("br"),s("span",{staticClass:"line-number"},[n._v("250")]),s("br"),s("span",{staticClass:"line-number"},[n._v("251")]),s("br"),s("span",{staticClass:"line-number"},[n._v("252")]),s("br"),s("span",{staticClass:"line-number"},[n._v("253")]),s("br"),s("span",{staticClass:"line-number"},[n._v("254")]),s("br"),s("span",{staticClass:"line-number"},[n._v("255")]),s("br"),s("span",{staticClass:"line-number"},[n._v("256")]),s("br"),s("span",{staticClass:"line-number"},[n._v("257")]),s("br"),s("span",{staticClass:"line-number"},[n._v("258")]),s("br"),s("span",{staticClass:"line-number"},[n._v("259")]),s("br"),s("span",{staticClass:"line-number"},[n._v("260")]),s("br"),s("span",{staticClass:"line-number"},[n._v("261")]),s("br"),s("span",{staticClass:"line-number"},[n._v("262")]),s("br"),s("span",{staticClass:"line-number"},[n._v("263")]),s("br"),s("span",{staticClass:"line-number"},[n._v("264")]),s("br"),s("span",{staticClass:"line-number"},[n._v("265")]),s("br"),s("span",{staticClass:"line-number"},[n._v("266")]),s("br"),s("span",{staticClass:"line-number"},[n._v("267")]),s("br"),s("span",{staticClass:"line-number"},[n._v("268")]),s("br"),s("span",{staticClass:"line-number"},[n._v("269")]),s("br"),s("span",{staticClass:"line-number"},[n._v("270")]),s("br"),s("span",{staticClass:"line-number"},[n._v("271")]),s("br"),s("span",{staticClass:"line-number"},[n._v("272")]),s("br"),s("span",{staticClass:"line-number"},[n._v("273")]),s("br"),s("span",{staticClass:"line-number"},[n._v("274")]),s("br"),s("span",{staticClass:"line-number"},[n._v("275")]),s("br"),s("span",{staticClass:"line-number"},[n._v("276")]),s("br"),s("span",{staticClass:"line-number"},[n._v("277")]),s("br"),s("span",{staticClass:"line-number"},[n._v("278")]),s("br"),s("span",{staticClass:"line-number"},[n._v("279")]),s("br"),s("span",{staticClass:"line-number"},[n._v("280")]),s("br"),s("span",{staticClass:"line-number"},[n._v("281")]),s("br"),s("span",{staticClass:"line-number"},[n._v("282")]),s("br"),s("span",{staticClass:"line-number"},[n._v("283")]),s("br"),s("span",{staticClass:"line-number"},[n._v("284")]),s("br"),s("span",{staticClass:"line-number"},[n._v("285")]),s("br"),s("span",{staticClass:"line-number"},[n._v("286")]),s("br"),s("span",{staticClass:"line-number"},[n._v("287")]),s("br"),s("span",{staticClass:"line-number"},[n._v("288")]),s("br"),s("span",{staticClass:"line-number"},[n._v("289")]),s("br"),s("span",{staticClass:"line-number"},[n._v("290")]),s("br"),s("span",{staticClass:"line-number"},[n._v("291")]),s("br"),s("span",{staticClass:"line-number"},[n._v("292")]),s("br"),s("span",{staticClass:"line-number"},[n._v("293")]),s("br"),s("span",{staticClass:"line-number"},[n._v("294")]),s("br"),s("span",{staticClass:"line-number"},[n._v("295")]),s("br"),s("span",{staticClass:"line-number"},[n._v("296")]),s("br"),s("span",{staticClass:"line-number"},[n._v("297")]),s("br"),s("span",{staticClass:"line-number"},[n._v("298")]),s("br"),s("span",{staticClass:"line-number"},[n._v("299")]),s("br"),s("span",{staticClass:"line-number"},[n._v("300")]),s("br"),s("span",{staticClass:"line-number"},[n._v("301")]),s("br"),s("span",{staticClass:"line-number"},[n._v("302")]),s("br"),s("span",{staticClass:"line-number"},[n._v("303")]),s("br"),s("span",{staticClass:"line-number"},[n._v("304")]),s("br"),s("span",{staticClass:"line-number"},[n._v("305")]),s("br"),s("span",{staticClass:"line-number"},[n._v("306")]),s("br"),s("span",{staticClass:"line-number"},[n._v("307")]),s("br"),s("span",{staticClass:"line-number"},[n._v("308")]),s("br"),s("span",{staticClass:"line-number"},[n._v("309")]),s("br"),s("span",{staticClass:"line-number"},[n._v("310")]),s("br"),s("span",{staticClass:"line-number"},[n._v("311")]),s("br"),s("span",{staticClass:"line-number"},[n._v("312")]),s("br"),s("span",{staticClass:"line-number"},[n._v("313")]),s("br"),s("span",{staticClass:"line-number"},[n._v("314")]),s("br"),s("span",{staticClass:"line-number"},[n._v("315")]),s("br"),s("span",{staticClass:"line-number"},[n._v("316")]),s("br"),s("span",{staticClass:"line-number"},[n._v("317")]),s("br"),s("span",{staticClass:"line-number"},[n._v("318")]),s("br"),s("span",{staticClass:"line-number"},[n._v("319")]),s("br"),s("span",{staticClass:"line-number"},[n._v("320")]),s("br"),s("span",{staticClass:"line-number"},[n._v("321")]),s("br"),s("span",{staticClass:"line-number"},[n._v("322")]),s("br"),s("span",{staticClass:"line-number"},[n._v("323")]),s("br"),s("span",{staticClass:"line-number"},[n._v("324")]),s("br"),s("span",{staticClass:"line-number"},[n._v("325")]),s("br"),s("span",{staticClass:"line-number"},[n._v("326")]),s("br"),s("span",{staticClass:"line-number"},[n._v("327")]),s("br"),s("span",{staticClass:"line-number"},[n._v("328")]),s("br"),s("span",{staticClass:"line-number"},[n._v("329")]),s("br"),s("span",{staticClass:"line-number"},[n._v("330")]),s("br"),s("span",{staticClass:"line-number"},[n._v("331")]),s("br"),s("span",{staticClass:"line-number"},[n._v("332")]),s("br"),s("span",{staticClass:"line-number"},[n._v("333")]),s("br"),s("span",{staticClass:"line-number"},[n._v("334")]),s("br"),s("span",{staticClass:"line-number"},[n._v("335")]),s("br"),s("span",{staticClass:"line-number"},[n._v("336")]),s("br"),s("span",{staticClass:"line-number"},[n._v("337")]),s("br"),s("span",{staticClass:"line-number"},[n._v("338")]),s("br"),s("span",{staticClass:"line-number"},[n._v("339")]),s("br"),s("span",{staticClass:"line-number"},[n._v("340")]),s("br"),s("span",{staticClass:"line-number"},[n._v("341")]),s("br"),s("span",{staticClass:"line-number"},[n._v("342")]),s("br"),s("span",{staticClass:"line-number"},[n._v("343")]),s("br"),s("span",{staticClass:"line-number"},[n._v("344")]),s("br"),s("span",{staticClass:"line-number"},[n._v("345")]),s("br"),s("span",{staticClass:"line-number"},[n._v("346")]),s("br"),s("span",{staticClass:"line-number"},[n._v("347")]),s("br"),s("span",{staticClass:"line-number"},[n._v("348")]),s("br"),s("span",{staticClass:"line-number"},[n._v("349")]),s("br"),s("span",{staticClass:"line-number"},[n._v("350")]),s("br"),s("span",{staticClass:"line-number"},[n._v("351")]),s("br"),s("span",{staticClass:"line-number"},[n._v("352")]),s("br"),s("span",{staticClass:"line-number"},[n._v("353")]),s("br"),s("span",{staticClass:"line-number"},[n._v("354")]),s("br"),s("span",{staticClass:"line-number"},[n._v("355")]),s("br"),s("span",{staticClass:"line-number"},[n._v("356")]),s("br"),s("span",{staticClass:"line-number"},[n._v("357")]),s("br"),s("span",{staticClass:"line-number"},[n._v("358")]),s("br"),s("span",{staticClass:"line-number"},[n._v("359")]),s("br"),s("span",{staticClass:"line-number"},[n._v("360")]),s("br"),s("span",{staticClass:"line-number"},[n._v("361")]),s("br"),s("span",{staticClass:"line-number"},[n._v("362")]),s("br"),s("span",{staticClass:"line-number"},[n._v("363")]),s("br"),s("span",{staticClass:"line-number"},[n._v("364")]),s("br"),s("span",{staticClass:"line-number"},[n._v("365")]),s("br"),s("span",{staticClass:"line-number"},[n._v("366")]),s("br"),s("span",{staticClass:"line-number"},[n._v("367")]),s("br"),s("span",{staticClass:"line-number"},[n._v("368")]),s("br"),s("span",{staticClass:"line-number"},[n._v("369")]),s("br"),s("span",{staticClass:"line-number"},[n._v("370")]),s("br"),s("span",{staticClass:"line-number"},[n._v("371")]),s("br"),s("span",{staticClass:"line-number"},[n._v("372")]),s("br"),s("span",{staticClass:"line-number"},[n._v("373")]),s("br"),s("span",{staticClass:"line-number"},[n._v("374")]),s("br"),s("span",{staticClass:"line-number"},[n._v("375")]),s("br"),s("span",{staticClass:"line-number"},[n._v("376")]),s("br"),s("span",{staticClass:"line-number"},[n._v("377")]),s("br"),s("span",{staticClass:"line-number"},[n._v("378")]),s("br"),s("span",{staticClass:"line-number"},[n._v("379")]),s("br"),s("span",{staticClass:"line-number"},[n._v("380")]),s("br"),s("span",{staticClass:"line-number"},[n._v("381")]),s("br"),s("span",{staticClass:"line-number"},[n._v("382")]),s("br"),s("span",{staticClass:"line-number"},[n._v("383")]),s("br"),s("span",{staticClass:"line-number"},[n._v("384")]),s("br"),s("span",{staticClass:"line-number"},[n._v("385")]),s("br"),s("span",{staticClass:"line-number"},[n._v("386")]),s("br"),s("span",{staticClass:"line-number"},[n._v("387")]),s("br"),s("span",{staticClass:"line-number"},[n._v("388")]),s("br"),s("span",{staticClass:"line-number"},[n._v("389")]),s("br"),s("span",{staticClass:"line-number"},[n._v("390")]),s("br"),s("span",{staticClass:"line-number"},[n._v("391")]),s("br"),s("span",{staticClass:"line-number"},[n._v("392")]),s("br"),s("span",{staticClass:"line-number"},[n._v("393")]),s("br")])]),s("center",[n._v(" renderer.ts ")]),n._v(" "),s("h3",{attrs:{id:"component"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#component"}},[n._v("#")]),n._v(" component")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('//组件中所有方法\n\nimport { isFunction, isObject, ShapeFlags } from "@vue/shared"\nimport { PublicInstanceProxyHandlers } from "./componentPublicInstance"\n\nexport function createComponentInstance(vnode) {\n    const instance = { //组件的实例\n        vnode,\n        type: vnode.type,\n        props: {},\n        atrrs: {},\n        slots: {},\n        ctx: null,\n        setupState: {},//如果setup返回一个对象，那么这个对象作为setupState\n        isMounted: false,//表示组件是否被挂载\n    }\n    instance.ctx = { _: instance }\n    return instance\n}\n\nexport function setupComponent(instance) {\n    const { props, children } = instance.vnode\n    //根据props解析出props和attrs\n    instance.children = children//插槽的解析initSlot()\n    instance.props = props//初始化initProps()\n\n    //需要看下当前组件是不是有状态的组件，函数组件\n    let isStateful = instance.vnode.shapeFlags & ShapeFlags.STATEFUL_COMPONENT\n    if (isStateful) {//表示现在是一个带状态的组件\n        //调用当前的setup方法，用setup返回值填充setupState和对应的render方法\n        setupStatefulComponent(instance)\n    }\n\n}\n\nfunction setupStatefulComponent(instance) {\n    //1代理，传递给函数的参数\n    instance.proxy = new Proxy(instance.ctx, PublicInstanceProxyHandlers as any)\n    //2获取组件的类型，拿到组件的setup方法\n    let component = instance.type\n    let { setup } = component\n    let setupContext = createSetupContext(instance)//instance中的props attrs slots emit expose都被提取出来\n    if (setup) {\n        let setupResult = setup(instance.props, setupContext)\n        // component.render(instance.proxy)测试用\n        handleSetupResult(instance, setupResult)\n    } else {\n        finishComponentSetup(instance)//完成组件的启动\n    }\n}\n\nfunction handleSetupResult(instance, setupResult) {\n    if (isFunction(setupResult)) {\n        instance.render = setupResult\n    } else if (isObject(setupResult)) {\n        instance.setupState = setupResult\n    }\n    finishComponentSetup(instance)\n}\n\nfunction finishComponentSetup(instance) {\n    let component = instance.type\n    const { render } = component\n    if (!instance.render) {//对template模板进行编译产生render函数\n        //instance.render = render//将生成的render函数放在实例上\n        if (!component.render && component.template) {\n         //编译将结果赋给component.render \n         //再赋给instace.render\n        }\n        instance.render = component.render\n    }\n    //对vue2.x做了兼容\n    //applyOptions\n}\n\nfunction createSetupContext(instance) {\n    return {\n        attrs: instance.atrrs,\n        slots: instance.slots,\n        // props: instance.props,\n        emit: () => { },\n        expose: () => { }\n    }\n}\n\n//instance 表示组件的状态，各种各样的状态\n//context 是为了开发时使用\n//proxy 主要是为了取值方便\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br")])]),s("center",[n._v(" component.ts ")]),n._v(" "),s("h3",{attrs:{id:"h函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#h函数"}},[n._v("#")]),n._v(" h函数")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import { isArray, isObject } from "@vue/shared"\nimport { createVNode, isVNode } from "./vnode"\n\nexport function h(type, propsOrChildren, children) {\n    let l = arguments.length//儿子节点要么是字符串要么是数组，针对的是createVNode\n    if (l == 2) {//类型+属性  类型+孩子\n        //如果第二个参数不是对象，那就是孩子\n        //如果是数组直接作为第三个参数\n        if (isObject(propsOrChildren) && !isArray(propsOrChildren)) {\n            if (isVNode(propsOrChildren)) {\n                return createVNode(type, null, [propsOrChildren])\n            }\n            return createVNode(type, propsOrChildren)\n\n        } else {\n            return createVNode(type, null, propsOrChildren)\n        }\n    }\n    else {\n        if (l > 3) {\n            children = Array.prototype.slice.call(arguments, 2)\n        } else if (l === 3 && isVNode(children)) {\n            children = [children]\n        }\n\n        return createVNode(type, propsOrChildren, children)\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br")])]),s("center",[n._v(" h.ts ")]),n._v(" "),s("h3",{attrs:{id:"apicreateapp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#apicreateapp"}},[n._v("#")]),n._v(" apiCreateApp")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import { createVNode } from "./vnode"\n\nexport function createAppApi(render) {\n    return function createApp(rootComponent, rootProps) {//告诉core用哪个组件哪个属性创建应用\n        const app = {\n            _rootProps: rootProps,\n            _rootComponent: rootComponent,\n            _container: null,\n            mount(container) {//挂载的地方\n                // let vnode = {}\n\n                //流程\n                //1根据组件创建虚拟节点\n                //2虚拟节点和容器获取到后，调用renderer方法\n\n                //创建虚拟节点\n                const vnode = createVNode(rootComponent, rootProps)\n                console.info(vnode)\n                //调用render方法\n                render(vnode, container)//将vnode渲染后容器上\n                app._container = container\n            }\n        }\n        return app\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br")])]),s("center",[n._v(" apiCreateApp.ts ")]),n._v(" "),s("h3",{attrs:{id:"componentpublicinstance"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#componentpublicinstance"}},[n._v("#")]),n._v(" componentPublicInstance")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import { hasOwn } from "@vue/shared"\n\nexport const PublicInstanceProxyHandlers = {\n    get({ _: instance }, key) {\n        const { setupState, props, data } = instance\n        if (key[0] === "$") return //不能访问$开头的变量\n        if (hasOwn(setupState, key)) {\n            return setupState[key];\n        } else if (hasOwn(props, key)) {\n            return props[key]\n        } else if (hasOwn(data, key)) {\n            return data[key]\n        } else {\n            return undefined\n        }\n    },\n    set({ _: instance }, key, value) {\n        const { setupState, props, data } = instance\n        if (hasOwn(setupState, key)) {\n            setupState[key] = value;\n        } else if (hasOwn(props, key)) {\n            props[key] = value\n        } else if (hasOwn(data, key)) {\n            data[key] = value\n        } else {\n            return false\n        }\n\n        return true\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br")])]),s("center",[n._v(" componentPublicInstance.ts ")]),n._v(" "),s("h3",{attrs:{id:"index"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#index"}},[n._v("#")]),n._v(" index")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("export { createRender } from './renderer'\nexport { h } from './h'\n\nexport * from \"@vue/reactivity\"\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("center",[n._v(" index.ts ")]),n._v(" "),s("h3",{attrs:{id:"scheduler"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scheduler"}},[n._v("#")]),n._v(" scheduler")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("let queue = []\nexport function queueJob(job) {\n    if (!queue.includes(job)) {\n        queue.push(job)\n        queueFlush()\n    }\n}\n\nlet isFlushPeding = false\n\nexport function queueFlush() {\n    if (!isFlushPeding) {\n        isFlushPeding = true\n        Promise.resolve().then(flushJobs)\n    }\n}\n\nfunction flushJobs() {\n    isFlushPeding = false\n    //先刷新父再刷新子\n    queue.sort((a, b) => a.id - b.id)\n\n    for (let i = 0; i < queue.length; i++) {\n        const job = queue[i]\n        job()\n    }\n\n    queue.length = 0\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br")])]),s("center",[n._v(" scheduler.ts ")]),n._v(" "),s("h3",{attrs:{id:"vnode"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vnode"}},[n._v("#")]),n._v(" vnode")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("\n//h方法就是创建虚拟节点的vnode\n\nimport { isArray, isObject, isString, ShapeFlags } from \"@vue/shared\"\n\nexport function isVNode(vnode) {\n    return vnode.__v_isNode\n}\n\nexport function createVNode(type, props, children = null) {\n    //根据type来区分是元素还是对象\n\n    //根据type来区分是元素(字符串)还是组件(对象)\n    const shapeFlags = isString(type) ? ShapeFlags.ELEMENT : isObject(type) ? ShapeFlags.COMPONENT : 0\n\n\n    //给虚拟节点加一个类型\n    const vnode = {//一个对象来描述对应的内容，虚拟节点具有跨平台的功能\n        __v_isNode: true,\n        type,\n        props,\n        children,\n        component: null,//存放组件对应的实例\n        el: null,//稍后会将虚拟节点和真是节点对应起来\n        key: props && props.key,//diff算法会用到key\n        shapeFlags\n    }\n    normalizeChildren(vnode, children)\n    return vnode\n}\n\nfunction normalizeChildren(vnode, children) {\n    let type = 0\n    if (children == null) {//不对儿子进行处理\n\n    } else if (isArray(children)) {\n        type = ShapeFlags.ARRAY_CHILDREN//表示儿子是个数组\n    } else {\n        type = ShapeFlags.TEXT_CHILDREN\n    }\n    vnode.shapeFlags = vnode.shapeFlags | type\n}\n\nexport const Text = Symbol('Text')\n\nexport function normalizeVNode(child) {\n    if (isObject(child)) return child\n    return createVNode(Text, null, String(child))\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br")])]),s("center",[n._v(" vnode.ts ")]),n._v(" "),s("h3",{attrs:{id:"sequence"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#sequence"}},[n._v("#")]),n._v(" sequence")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("const arr = [2, 3, 1, 5, 6, 8, 7, 9, 4]\n\nfunction getSequence(arr) {\n    const len = arr.length\n    const result = [0]//默认第0个为参照物\n    let p = arr.slice(0)//里面内容无所谓 和原本的数组相同 用来存放索引\n    let start\n    let end\n    let middle\n\n    for (let i = 0; i < len; i++) {\n        const arrI = arr[i]\n        if (arrI !== 0) {\n            let resultLastIndex = result[result.length - 1]\n            if (arr[resultLastIndex] < arrI) {\n                p[i] = resultLastIndex//标记当前前一个对应的索引\n                result.push(i)\n                continue\n            }\n        }\n\n        //二分查找，找到比当前值大的那一个\n        start = 0\n        end = result.length - 1\n        while (start < end) {\n            middle = ((start + end) / 2) | 0\n            if (arr[result[middle]] < arrI) {\n                start = middle + 1\n            } else {\n                end = middle\n            }//找到结果集中比当前这一项大的数\n\n            if (arrI < arr[result[start]]) {\n                if (start > 0) {\n                    p[i] = result[start - 1]//将它替换成前一个\n                }\n                result[start] = i\n            }\n        }\n    }\n\n    let len1 = result.length\n    let last = result[len1 - 1]\n    while (len1-- > 0) {//根据前驱节点一个个向前查找\n        result[len1] = last\n        last = p[last]\n    }\n    return result;\n}\n\nconsole.log(getSequence(arr))\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br")])]),s("center",[n._v(" sequence.ts ")]),n._v(" "),s("h2",{attrs:{id:"runtime-dom介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#runtime-dom介绍"}},[n._v("#")]),n._v(" runtime-dom介绍")]),n._v(" "),s("ul",[s("li",[n._v("需要涵盖dom操作api，属性操作api，事件操作api，并将这些api传入到runtime-core中运行")]),n._v(" "),s("li",[n._v("我们在渲染页面的时候进行的节点操作的一系列方法")])]),n._v(" "),s("h3",{attrs:{id:"index-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#index-2"}},[n._v("#")]),n._v(" index")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('//这个包的核心就是提供dom api的，操作节点、操作属性的更新\n//1节点操作无非就是增删改查\n//2属性操作无非就是样式、类、事件、普通事件、其他属性的增删改\n\nimport { extend } from "@vue/shared";\nimport { nodePos } from "./nodeOps";\nimport { patchProp } from "./patchProp";\nimport { createRender } from "@vue/runtime-core"\n\n//渲染时用到的所有方法\nexport const rendererOptions = extend({ patchProp }, nodePos)\n\n// vue-runtime-core里提供了核心的渲染方法，用来处理渲染，他会使用runtime-dom中的api进行渲染\nexport function createApp(rootComponent, rootProps = null) {\n    const app: any = createRender(rendererOptions).createApp(rootComponent, rootProps)\n    let { mount } = app\n    app.mount = function (container) {\n        container = document.querySelector(container)\n        container.innerHTML = \'\'\n        //将组件渲染成dom元素进行挂载\n        mount(container)\n    }\n    return app\n}\n\nexport * from \'@vue/runtime-core\'\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br")])]),s("center",[n._v(" index.ts ")]),n._v(" "),s("h3",{attrs:{id:"nodeops"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nodeops"}},[n._v("#")]),n._v(" nodeOps")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("export const nodePos = {\n    //createElement，不同的平台创建元素的方式不同\n\n    //元素\n    createElement: (tagName) => document.createElement(tagName),//增加\n    remove: (child) => {//删除\n        const parent = child.parentNode\n        if (parent) {\n            parent.removeChild(child)\n        }\n    },\n    insert: (child, parent, anchor = null) => {\n        parent.insertBefore(child, anchor)//如果anchor为空，相当于appendChild\n    },\n    querySelector: (selector) => document.querySelector(selector),//查询\n    setElementText: (el, text) => el.textContent = text,//设置文本内容\n    nextSibling: (node) => node.nextSibling,\n    \n    //文本操作，创建文本\n    createText: (text) => document.createTextNode(text),//创建文本\n    setText: (node, text) => node.nodeValue = text,//给节点设置文本\n}\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br")])]),s("center",[n._v(" nodeOps.ts ")]),n._v(" "),s("h3",{attrs:{id:"patchprop"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#patchprop"}},[n._v("#")]),n._v(" patchProp")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('//这里面针对是一系列属性操作\n\nimport { patchAttr } from "./modules/attr"\nimport { patchClass } from "./modules/class"\nimport { patchEvents } from "./modules/events"\nimport { patchStyle } from "./modules/style"\n\nexport const patchProp = (el, key, preValue, nextValue) => {\n    switch (key) {\n        case \'class\':\n            patchClass(el, nextValue)\n            break\n        case \'style\':\n            patchStyle(el, preValue, nextValue)\n            break\n        default:\n            if (/^on[^a-z]/.test(key)) {\n                patchEvents(el, key, nextValue)\n            } else {\n                patchAttr(el, key, nextValue)\n            }\n            break\n    }\n}\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br")])]),s("center",[n._v(" patchProp.ts ")])],1)}),[],!1,null,null,null);s.default=t.exports}}]);